<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8"/>
  
  <!-- VIEWPORT √öNICA E OTIMIZADA PARA PWA MOBILE -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  
  <!-- MANIFEST E TEMA -->
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#8e44ad" />
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">

  <!-- PWA META TAGS OTIMIZADAS -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Viza Ilumina√ß√£o">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  
  <!-- TILES E CORES WINDOWS -->
  <meta name="msapplication-TileImage" content="/images/icon-512x512.png">
  <meta name="msapplication-TileColor" content="#8e44ad">

  <!-- APPLE TOUCH ICONS -->
  <link rel="apple-touch-icon" href="/images/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/images/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/images/icon-512x512.png">

  <!-- TITULO DA GUIA -->
  <title>Sistema De Ilumina√ß√£o Viza Atacadista</title>

  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      min-height: 100vh;
    }
    
    /* Espa√ßo para menu inferior apenas em mobile */
    @media (max-width: 767px) {
      body {
        padding-bottom: 80px;
      }
    }

    /* ========== SISTEMA DE NOTIFICA√á√ïES TOAST ========== */
    
    /* Container das notifica√ß√µes */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
      pointer-events: none;
    }

    /* Estilo base do toast */
    .toast {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      max-width: 350px;
      min-width: 320px;
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: auto;
      position: relative;
      overflow: hidden;
    }

    /* Toast vis√≠vel */
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    /* Toast saindo */
    .toast.hide {
      transform: translateX(100%);
      opacity: 0;
      margin-bottom: -80px;
    }

    /* √çcones dos toasts */
    .toast-icon {
      font-size: 20px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    /* Conte√∫do do toast */
    .toast-content {
      flex: 1;
      min-width: 0;
    }

    .toast-title {
      font-weight: 600;
      font-size: 14px;
      margin: 0 0 4px 0;
      color: #2c3e50;
      line-height: 1.3;
    }

    .toast-message {
      font-size: 13px;
      color: #64748b;
      margin: 0;
      line-height: 1.4;
    }

    /* Bot√£o de fechar */
    .toast-close {
      background: none;
      border: none;
      color: #94a3b8;
      cursor: pointer;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .toast-close:hover {
      background: rgba(0, 0, 0, 0.1);
      color: #64748b;
    }

    /* Barra de progresso */
    .toast-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: currentColor;
      border-radius: 0 0 12px 12px;
      opacity: 0.3;
      transition: width linear;
    }

    .toast.success {
      border-left: 4px solid #10b981;
    }
    .toast.success .toast-icon { color: #10b981; }
    .toast.success .toast-progress { background: #10b981; }

    .toast.error {
      border-left: 4px solid #ef4444;
    }
    .toast.error .toast-icon { color: #ef4444; }
    .toast.error .toast-progress { background: #ef4444; }

    .toast.warning {
      border-left: 4px solid #f59e0b;
    }
    .toast.warning .toast-icon { color: #f59e0b; }
    .toast.warning .toast-progress { background: #f59e0b; }

    .toast.info {
      border-left: 4px solid #3b82f6;
    }
    .toast.info .toast-icon { color: #3b82f6; }
    .toast.info .toast-progress { background: #3b82f6; }

    .toast.system {
      border-left: 4px solid #8b5cf6;
    }
    .toast.system .toast-icon { color: #8b5cf6; }
    .toast.system .toast-progress { background: #8b5cf6; }

    /* ========== MENU INFERIOR ESTILO APP ========== */
    
    /* ========== NAVEGA√á√ÉO NO CABE√áALHO ========== */
    .bottom-nav {
      display: none; /* Oculto por padr√£o no desktop */
    }
    
    @media (max-width: 767px) {
      .bottom-nav {
        display: block; /* Mostrar apenas no mobile */
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        padding: 8px 0;
        z-index: 1000;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        margin-top: 0;
      }
    }
    
    .nav-container {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px 8px;
      text-decoration: none;
      color: #666;
      border-radius: 12px;
      transition: all 0.3s ease;
      min-width: 60px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .nav-item.active {
      color: #8e44ad;
      background: rgba(142, 68, 173, 0.1);
    }
    
    .nav-item:hover {
      color: #8e44ad;
      background: rgba(142, 68, 173, 0.05);
    }
    
    .nav-icon {
      font-size: 20px;
      margin-bottom: 2px;
      line-height: 1;
    }
    
    .nav-label {
      font-size: 10px;
      font-weight: 500;
      text-align: center;
      line-height: 1.2;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      padding: 15px 20px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      position: sticky;
      top: 0;
      z-index: 999;
      gap: 20px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 0 0 auto;
    }
    
    .header-center {
      flex: 0 0 auto;
      text-align: left;
      margin-left: 40px;
    }
    
    .header-title-section {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 2px;
    }
    
    .header-title {
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
      margin: 0;
      line-height: 1.2;
    }
    
    .header-subtitle {
      font-size: 12px;
      color: #6c757d;
      margin: 0;
      font-weight: 500;
      text-align: left;
      margin-left: 0;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex: 1;
      gap: 25px;
    }
    
    .header-nav-section {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
      justify-content: center;
    }
    
    .header-logo-right {
      flex: 0 0 auto;
    }

    .logo {
      height: 40px;
      object-fit: contain;
    }
    
    nav a {
      margin: 0 8px;
      text-decoration: none;
      color: #333;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: inline-block;
      font-size: 14px;
    }
    
    nav a:hover {
      background: rgba(142,68,173,0.1);
      color: #8e44ad;
    }

    /* Status da conex√£o no header */
    .status-conexao {
      font-size: 11px;
      font-weight: 700;
      transition: all 0.3s ease;
      white-space: nowrap;
      padding: 4px 8px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .status-online {
      color: #10b981;
    }
    
    .status-offline {
      color: #ef4444;
    }
    
    .status-connecting {
      color: #fbbf24;
    }
    
    main {
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    
    /* Cards de configura√ß√£o */
    .card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.18);
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }
    
    .card h2 {
      margin: 0 0 20px 0;
      color: #2c3e50;
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      position: relative;
    }
    
    .card h2:after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 3px;
      background: linear-gradient(90deg, #8B5CF6, #7C3AED);
      border-radius: 2px;
    }
    
    /* Status Bar */
    .status-bar {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 25px;
      border: 2px solid rgba(195, 54, 54, 0.1);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      align-items: center;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      text-align: center;
      justify-content: center;
      white-space: nowrap;
      min-height: 45px;
    }
    
    .status-item.status-online {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-item.status-offline {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-item.status-warning {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    
    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 25px;
      margin-bottom: 25px;
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #495057;
      font-size: 16px;
    }
    
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      background: white;
      transition: all 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #8B5CF6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      margin-bottom: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    
    .btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
      color: white;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
    }
    
    .btn-success:hover {
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
    }
    
    .btn-warning {
      background: linear-gradient(135deg, #F59E0B, #FBBF24);
      color: white;
    }
    
    .btn-warning:hover {
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }
    
    .btn-danger:hover {
      box-shadow: 0 6px 20px rgba(220, 53, 69, 0.3);
    }
    
    /* Info Box */
    .info-box {
      background: rgba(51, 122, 183, 0.1);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      color: #337ab7;
      border-left: 4px solid #337ab7;
    }
    
    .info-box strong {
      color: #0d47a1;
    }
    
    /* Toggle Switch */
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 34px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #8B5CF6;
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .toggle-label {
      font-weight: 600;
      color: #495057;
    }
    
    /* Loading Spinner */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsividade apenas para MOBILE */
    @media (max-width: 767px) {
      .toast-container {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
      }
      
      .toast {
        min-width: auto;
        max-width: none;
        font-size: 12px;
        padding: 12px 16px;
      }

      header {
        padding: 10px 15px;
        gap: 15px;
        flex-direction: column;
      }
      
      /* Reorganizar para mobile: logos primeiro */
      .header-left, .header-right {
        width: auto;
        flex: none;
      }
      
      .header-left {
        order: 1;
        align-self: flex-start;
      }
      
      .header-right {
        order: 2;
        align-self: flex-end;
        position: absolute;
        top: 10px;
        right: 15px;
      }
      
      .header-nav-section {
        display: none; /* Ocultar menu no mobile */
      }
      
      .header-logo-right {
        display: flex;
      }
      
      .header-center {
        order: 3;
        margin-bottom: 0;
        margin-left: 0;
        margin-top: 10px;
        text-align: center;
        width: 100%;
      }
      
      .header-title-section {
        flex-direction: column;
        gap: 8px;
        justify-content: center;
        align-items: center;
      }
      
      .header-title {
        font-size: 16px;
        text-align: center;
        order: 1;
      }
      
      .header-subtitle {
        font-size: 11px;
        text-align: center;
        order: 2;
      }
      
      .status-conexao {
        order: 3;
        font-size: 10px;
        padding: 3px 6px;
        margin-top: 5px;
      }

      header nav {
        display: none; /* Ocultar menu de navega√ß√£o no mobile */
      }

      .logo {
        height: 32px;
      }

      main {
        padding: 15px;
      }

      .card {
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 12px;
      }
      
      .grid {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .status-bar {
        flex-direction: column;
        align-items: stretch;
      }
      
      .btn {
        padding: 10px 16px;
        font-size: 13px;
      }
    }

    /* Anima√ß√µes */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .card {
      animation: fadeInUp 0.6s ease forwards;
    }

  </style>
</head>
<body>
  <!-- Container das notifica√ß√µes (sempre presente) -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Menus e Logos-->   
  <header>
    <div class="header-left">
      <a href="/"><img src="images/Viza_Logo.png" alt="Viza" class="logo"></a>
    </div>
    
    <div class="header-center">
      <div class="header-title-section">
        <h1 class="header-title">Sistema De Ilumina√ß√£o Viza</h1>
        <!-- Status da conex√£o -->
        <div id="status-conexao" class="status-conexao status-connecting">
          <span id="status-text">Conectando</span>
        </div>
      </div>
      <p class="header-subtitle">Controle Inteligente De Ilumina√ß√£o</p>
    </div>
    
    <div class="header-right">
      <div class="header-nav-section">
        <nav>
          <a href="/">üè¢ Opera√ß√£o</a>
          <a href="/Visualizacao">üìä Visualiza√ß√£o</a>
          <a href="/Consumo">‚ö° Consumo</a>
          <a href="/Banco">üóÑÔ∏è Banco</a>
          <a href="/Manual">üìñ Manual</a>
        </nav>
      </div>
      
      <div class="header-logo-right">
        <img src="images/Engemase_Logo.png" alt="Engemase" class="logo">
      </div>
    </div>
  </header>
  
  <main>
    <!-- T√≠tulo Principal -->
    <div class="card">
      <h2>üóÑÔ∏è Configura√ß√£o Do Banco De Dados</h2>
      
      <!-- Barra de Status -->
      <div class="status-bar">
        <div class="status-item" id="dbStatus">
          <span>üî¥</span>
          <span>Banco: Verificando...</span>
        </div>
        <div class="status-item" id="backupStatus">
          <span>üíæ</span>
          <span>Backup: Inativo</span>
        </div>
        <div class="status-item" id="limpezaStatus">
          <span>üßπ</span>
          <span>Limpeza: Inativa</span>
        </div>
        <div class="status-item" id="schedulerStatus">
          <span>üîÑ</span>
          <span>Scheduler: Verificando...</span>
        </div>
      </div>
    </div>

    <div class="grid">
      <!-- Configura√ß√£o do SQLite -->
      <div class="card">
        <h2>üóÑÔ∏è Configura√ß√£o do SQLite</h2>
        
        <div class="info-box">
          <strong>SQLite:</strong> Configure o ip e a porta do banco de dados
        </div>

        <div class="form-group">
          <label>üåê IP Do Banco De Dados:</label>
          <input type="text" id="dbHost" placeholder="192.168.4.2" value="192.168.4.2">
        </div>

        <div class="form-group">
          <label>üîå Porta Do Banco De Dados:</label>
          <input type="number" id="dbPort" placeholder="5000" value="5000">
        </div>

        <button class="btn btn-primary" onclick="criarBanco()">
          <span id="createIcon">üÜï</span>
          <span id="createText">Criar Banco</span>
        </button>

        <button class="btn btn-success" onclick="iniciarBanco()">
          <span id="startIcon">‚ñ∂Ô∏è</span>
          <span id="startText">Iniciar Banco</span>
        </button>

        <button class="btn btn-danger" onclick="pararBanco()">
          ‚èπÔ∏è Parar Banco
        </button>
      </div>

      <!-- Configura√ß√µes de Backup -->
      <div class="card">
        <h2>üíæ Configura√ß√µes de Backup</h2>

        <div class="form-group">
          <label>Backup Autom√°tico:</label>
          <div class="toggle-container">
            <label class="toggle-switch">
              <input type="checkbox" id="backupAuto" onchange="toggleBackupAuto()">
              <span class="slider"></span>
            </label>
            <span class="toggle-label" id="backupAutoLabel">Desabilitado</span>
          </div>
        </div>

        <div class="form-group">
          <label>üìÖ Frequ√™ncia do Backup:</label>
          <select id="backupFrequencia" onchange="salvarConfigBackup()">
            <option value="1">üìÖ Di√°rio</option>
            <option value="7" selected>üìà Semanal</option>
            <option value="30">üìÜ Mensal</option>
          </select>
        </div>

        <div class="form-group">
          <label>‚è∞ Hor√°rio do Backup:</label>
          <input type="time" id="backupHorario" value="02:00" onchange="salvarConfigBackup()">
        </div>

        <button class="btn btn-warning" onclick="fazerBackupManual()">
          <span id="backupIcon">üíæ</span>
          <span id="backupText">Fazer Backup Agora</span>
        </button>

        <button class="btn btn-primary" onclick="restaurarBackup()">
          üì• Restaurar Backup
        </button>
      </div>
    </div>

    <!-- Card de Limpeza Autom√°tica -->
    <div class="card">
      <h2>üßπ Limpeza Autom√°tica de Dados</h2>

      <div class="info-box">
        <strong>Manuten√ß√£o:</strong> Configure a limpeza autom√°tica para otimizar o desempenho
      </div>

      <div class="form-group">
        <label>Limpeza Autom√°tica:</label>
        <div class="toggle-container">
          <label class="toggle-switch">
            <input type="checkbox" id="limpezaAuto" onchange="toggleLimpezaAuto()">
            <span class="slider"></span>
          </label>
          <span class="toggle-label" id="limpezaAutoLabel">Desabilitado</span>
        </div>
      </div>

      <div class="form-group">
        <label>üóìÔ∏è Frequ√™ncia da Limpeza:</label>
        <select id="limpezaFrequencia" onchange="salvarConfigLimpeza()">
          <option value="1">üåÖ Di√°rio (todo dia)</option>
          <option value="3">üìä A cada 3 dias</option>
          <option value="7" selected>üìà Semanal (7 dias)</option>
          <option value="15">üìã Quinzenal (15 dias)</option>
          <option value="30">üìÜ Mensal (30 dias)</option>
        </select>
      </div>

      <div class="form-group">
        <label>üìã Manter dados dos √∫ltimos:</label>
        <select id="diasManter" onchange="salvarConfigLimpeza()">
          <option value="7">7 dias</option>
          <option value="15">15 dias</option>
          <option value="30" selected>30 dias</option>
          <option value="60">60 dias</option>
          <option value="90">90 dias</option>
          <option value="365">1 ano</option>
        </select>
      </div>

      <button class="btn btn-warning" onclick="executarLimpeza()">
        <span id="cleanIcon">üßπ</span>
        <span id="cleanText">Executar Limpeza Agora</span>
      </button>
    </div>
  </main>

  <!-- Menu Inferior Estilo App -->
  <nav class="bottom-nav">
    <div class="nav-container">
      <a href="/" class="nav-item">
        <div class="nav-icon">üè¢</div>
        <div class="nav-label">Opera√ß√£o</div>
      </a>
      <a href="/Visualizacao" class="nav-item">
        <div class="nav-icon">üìä</div>
        <div class="nav-label">Visualiza√ß√£o</div>
      </a>
      <a href="/Consumo" class="nav-item">
        <div class="nav-icon">‚ö°</div>
        <div class="nav-label">Consumo</div>
      </a>
      <a href="/Banco" class="nav-item active">
        <div class="nav-icon">üóÑÔ∏è</div>
        <div class="nav-label">Banco</div>
      </a>
      <a href="/Manual" class="nav-item">
        <div class="nav-icon">üìñ</div>
        <div class="nav-label">Manual</div>
      </a>
    </div>
  </nav>

  <script>
    // ========== SISTEMA DE NOTIFICA√á√ïES TOAST ==========
    
    class ToastManager {
      constructor() {
        this.container = document.getElementById('toast-container');
        this.toasts = new Map();
        this.toastCounter = 0;
      }

      show(type, title, message, options = {}) {
        const id = ++this.toastCounter;
        const toast = this.createToast(id, type, title, message, options);
        
        this.container.appendChild(toast);
        this.toasts.set(id, toast);

        // Trigger animation
        setTimeout(() => toast.classList.add('show'), 10);

        // Auto remove (unless persistent)
        if (!options.persistent) {
          const duration = options.duration || 5000;
          setTimeout(() => this.remove(id), duration);
        }

        return id;
      }

      createToast(id, type, title, message, options) {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.dataset.id = id;

        const iconMap = {
          success: '‚úì',
          error: '‚úï',
          warning: '‚ö†',
          info: '‚Ñπ',
          system: '‚öô'
        };

        toast.innerHTML = `
          <div class="toast-icon">${iconMap[type] || '‚Ñπ'}</div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
          </div>
          <button class="toast-close" onclick="toast.remove(${id})">&times;</button>
          <div class="toast-progress"></div>
        `;

        return toast;
      }

      remove(id) {
        const toast = this.toasts.get(id);
        if (toast) {
          toast.classList.add('hide');
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
            this.toasts.delete(id);
          }, 400);
        }
      }

      success(title, message, options = {}) {
        return this.show('success', title, message, options);
      }

      error(title, message, options = {}) {
        return this.show('error', title, message, options);
      }

      warning(title, message, options = {}) {
        return this.show('warning', title, message, options);
      }

      info(title, message, options = {}) {
        return this.show('info', title, message, options);
      }

      system(title, message, options = {}) {
        return this.show('system', title, message, options);
      }
    }

    // Inst√¢ncia global do toast
    const toast = new ToastManager();

    // ========== VARI√ÅVEIS GLOBAIS DO BANCO DE DADOS ==========
    
    let dbConfig = {
      host: '192.168.4.2',
      port: 5000,
      backupAuto: false,
      backupFrequencia: 7,
      backupHorario: '02:00',
      limpezaAuto: false,
      limpezaFrequencia: 7,
      diasManter: 30
    };

    let dbStatus = {
      conectado: false,
      existe: false,
      schedulerRodando: false
    };

    // Vari√°veis para controle de status de conex√£o
    let statusConexao = false;
    let toastConexaoId = null;
    let verificandoConexao = false;
    let tentativasFalhas = 0;

    // ========== FUN√á√ÉO PARA CONSTRUIR URL DA API ==========
    function getApiUrl(endpoint) {
      const host = document.getElementById('dbHost').value || dbConfig.host;
      const port = document.getElementById('dbPort').value || dbConfig.port;
      return `http://${host}:${port}${endpoint}`;
    }

    // ========== FUN√á√ïES DE STATUS DO BANCO ==========
    function atualizarStatusInterface() {
      const dbStatusEl = document.getElementById('dbStatus');
      if (dbStatus.conectado) {
        dbStatusEl.innerHTML = '<span>üü¢</span><span>Banco: Conectado</span>';
        dbStatusEl.className = 'status-item status-online';
      } else {
        dbStatusEl.innerHTML = '<span>üî¥</span><span>Banco: Desconectado</span>';
        dbStatusEl.className = 'status-item status-offline';
      }

      const backupStatusEl = document.getElementById('backupStatus');
      if (dbConfig.backupAuto) {
        backupStatusEl.innerHTML = '<span>‚úÖ</span><span>Backup: Ativo</span>';
        backupStatusEl.className = 'status-item status-online';
      } else {
        backupStatusEl.innerHTML = '<span>üíæ</span><span>Backup: Inativo</span>';
        backupStatusEl.className = 'status-item status-warning';
      }

      const limpezaStatusEl = document.getElementById('limpezaStatus');
      if (dbConfig.limpezaAuto) {
        limpezaStatusEl.innerHTML = '<span>üßπ</span><span>Limpeza: Ativa</span>';
        limpezaStatusEl.className = 'status-item status-online';
      } else {
        limpezaStatusEl.innerHTML = '<span>üßπ</span><span>Limpeza: Inativa</span>';
        limpezaStatusEl.className = 'status-item status-warning';
      }

      const schedulerStatusEl = document.getElementById('schedulerStatus');
      if (dbStatus.schedulerRodando) {
        schedulerStatusEl.innerHTML = '<span>üü¢</span><span>Scheduler: Ativo</span>';
        schedulerStatusEl.className = 'status-item status-online';
      } else {
        schedulerStatusEl.innerHTML = '<span>üî¥</span><span>Scheduler: Parado</span>';
        schedulerStatusEl.className = 'status-item status-offline';
      }
    }

    // ========== FUN√á√ÉO PARA VERIFICAR STATUS DO SERVIDOR ==========
    async function verificarStatusServidor() {
      try {
        const response = await fetch(getApiUrl('/api/database/status'));
        if (response.ok) {
          const data = await response.json();
          dbStatus.conectado = data.connected;
          dbStatus.existe = data.exists;
          
          console.log('Status do servidor:', data);
          
          // Verificar scheduler
          await verificarScheduler();
          
          atualizarStatusInterface();
          return true;
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        console.error('Erro ao verificar status:', error);
        dbStatus.conectado = false;
        dbStatus.existe = false;
        dbStatus.schedulerRodando = false;
        atualizarStatusInterface();
        return false;
      }
    }

    async function verificarScheduler() {
      try {
        const response = await fetch(getApiUrl('/api/system/scheduler'));
        if (response.ok) {
          const data = await response.json();
          dbStatus.schedulerRodando = data.scheduler_running;
          console.log('Status do scheduler:', data);
        }
      } catch (error) {
        console.log('Erro ao verificar scheduler:', error);
        dbStatus.schedulerRodando = false;
      }
    }

    // ========== OPERA√á√ïES DO SQLITE ==========
    async function criarBanco() {
      const btn = event.target;
      const icon = document.getElementById('createIcon');
      const text = document.getElementById('createText');
      
      const dbHost = document.getElementById('dbHost').value;
      const dbPort = document.getElementById('dbPort').value;
      
      if (!dbHost || !dbPort) {
        toast.error('Campos Obrigat√≥rios', 'Informe o IP e porta do servidor');
        return;
      }

      btn.disabled = true;
      icon.innerHTML = '<span class="loading"></span>';
      text.textContent = 'Criando...';
      
      try {
        console.log(`Criando banco em: ${dbHost}:${dbPort}`);
        
        const response = await fetch(getApiUrl('/api/database/create'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({})
        });
        
        const data = await response.json();
        
        if (response.ok) {
          dbConfig.host = dbHost;
          dbConfig.port = parseInt(dbPort);
          dbStatus.existe = true;
          
          icon.textContent = '‚úÖ';
          text.textContent = 'Banco Criado';
          toast.success('Banco Criado', data.message);
          
          salvarConfiguracao();
          atualizarStatusInterface();
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error(`Erro ao criar banco: ${error.message}`);
        icon.textContent = '‚ùå';
        text.textContent = 'Erro na Cria√ß√£o';
        toast.error('Erro de Cria√ß√£o', `${error.message}`);
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          icon.textContent = 'üÜï';
          text.textContent = 'Criar Banco';
        }, 3000);
      }
    }

    async function iniciarBanco() {
      const btn = event.target;
      const icon = document.getElementById('startIcon');
      const text = document.getElementById('startText');

      const dbHost = document.getElementById('dbHost').value;
      const dbPort = document.getElementById('dbPort').value;

      if (!dbHost || !dbPort) {
        toast.error('Configura√ß√£o Incompleta', 'Informe o IP e porta do servidor');
        return;
      }

      btn.disabled = true;
      icon.innerHTML = '<span class="loading"></span>';
      text.textContent = 'Conectando...';
      
      try {
        console.log(`Conectando ao servidor: ${dbHost}:${dbPort}`);
        
        const response = await fetch(getApiUrl('/api/database/start'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          dbConfig.host = dbHost;
          dbConfig.port = parseInt(dbPort);
          dbStatus.conectado = true;
          dbStatus.existe = true;
          
          icon.textContent = '‚úÖ';
          text.textContent = 'Banco Conectado';
          
          toast.success('Banco Conectado', `Servidor conectado: ${dbHost}:${dbPort}`);
          
          salvarConfiguracao();
          await verificarScheduler();
          atualizarStatusInterface();
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error(`Erro ao conectar: ${error.message}`);
        icon.textContent = '‚ùå';
        text.textContent = 'Erro na Conex√£o';
        toast.error('Erro de Conex√£o', `Verifique se o servidor est√° rodando em ${dbHost}:${dbPort}`);
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          icon.textContent = '‚ñ∂Ô∏è';
          text.textContent = 'Iniciar Banco';
        }, 3000);
      }
    }

    async function pararBanco() {
      if (!dbStatus.conectado) {
        toast.warning('Banco Parado', 'O banco j√° est√° desconectado');
        return;
      }

      if (!confirm('Tem certeza que deseja desconectar do servidor?')) {
        return;
      }

      try {
        const response = await fetch(getApiUrl('/api/database/stop'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          dbStatus.conectado = false;
          atualizarStatusInterface();
          toast.success('Desconectado', data.message);
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error(`Erro ao desconectar: ${error.message}`);
        toast.error('Erro ao Desconectar', `${error.message}`);
      }
    }

    // ========== FUN√á√ïES DE BACKUP ==========
    function toggleBackupAuto() {
      const checkbox = document.getElementById('backupAuto');
      const label = document.getElementById('backupAutoLabel');
      
      dbConfig.backupAuto = checkbox.checked;
      label.textContent = checkbox.checked ? 'Habilitado' : 'Desabilitado';
      
      if (checkbox.checked) {
        toast.success('Backup Autom√°tico', 'Backup autom√°tico habilitado com sucesso');
      } else {
        toast.warning('Backup Autom√°tico', 'Backup autom√°tico foi desabilitado');
      }
      
      salvarConfiguracao();
      atualizarStatusInterface();
    }

    function salvarConfigBackup() {
      dbConfig.backupFrequencia = parseInt(document.getElementById('backupFrequencia').value);
      dbConfig.backupHorario = document.getElementById('backupHorario').value;
      
      const frequencias = {
        1: 'di√°rio',
        7: 'semanal',
        30: 'mensal'
      };
      
      toast.info('Configura√ß√£o Salva', 
        `Backup ${frequencias[dbConfig.backupFrequencia]} √†s ${dbConfig.backupHorario}h`);
      
      salvarConfiguracao();
    }

    async function fazerBackupManual() {
      if (!dbStatus.conectado) {
        toast.warning('Servidor Desconectado', 'Conecte ao servidor antes de fazer backup');
        return;
      }

      const btn = event.target;
      const icon = document.getElementById('backupIcon');
      const text = document.getElementById('backupText');
      
      btn.disabled = true;
      icon.innerHTML = '<span class="loading"></span>';
      text.textContent = 'Fazendo Backup...';
      
      try {
        console.log('Iniciando backup...');
        
        const response = await fetch(getApiUrl('/api/backup/create'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          icon.textContent = '‚úÖ';
          text.textContent = 'Backup Conclu√≠do';
          toast.success('Backup Manual', `Arquivo criado: ${data.backup_name}`);
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error(`Erro no backup: ${error.message}`);
        icon.innerHTML = '‚ùå';
        text.textContent = 'Erro no Backup';
        toast.error('Erro de Backup', `Falha ao criar backup: ${error.message}`);
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          icon.textContent = 'üíæ';
          text.textContent = 'Fazer Backup Agora';
        }, 3000);
      }
    }

    async function restaurarBackup() {
      if (!dbStatus.conectado) {
        toast.warning('Servidor Desconectado', 'Conecte ao servidor antes de restaurar');
        return;
      }

      const backupName = prompt('Digite o nome do arquivo de backup:');
      if (!backupName) return;

      if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Restaurar um backup ir√° substituir todos os dados atuais. Deseja continuar?')) {
        return;
      }

      const btn = event.target;
      const textoOriginal = btn.innerHTML;
      
      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> Restaurando...';

      try {
        console.log('Iniciando restaura√ß√£o de backup...');
        
        const response = await fetch(getApiUrl('/api/backup/restore'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            backup_name: backupName
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          btn.innerHTML = '‚úÖ Restaurado!';
          toast.success('Backup Restaurado', data.message);
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error(`Erro na restaura√ß√£o: ${error.message}`);
        btn.innerHTML = '‚ùå Erro na Restaura√ß√£o';
        toast.error('Erro de Restaura√ß√£o', `${error.message}`);
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          btn.innerHTML = textoOriginal;
        }, 3000);
      }
    }

    // ========== FUN√á√ïES DE LIMPEZA ==========
    function toggleLimpezaAuto() {
      const checkbox = document.getElementById('limpezaAuto');
      const label = document.getElementById('limpezaAutoLabel');
      
      dbConfig.limpezaAuto = checkbox.checked;
      label.textContent = checkbox.checked ? 'Habilitado' : 'Desabilitado';
      
      if (checkbox.checked) {
        toast.success('Limpeza Autom√°tica', 'Limpeza autom√°tica habilitada com sucesso');
      } else {
        toast.warning('Limpeza Autom√°tica', 'Limpeza autom√°tica foi desabilitada');
      }
      
      salvarConfiguracao();
      atualizarStatusInterface();
    }

    function salvarConfigLimpeza() {
      dbConfig.limpezaFrequencia = parseInt(document.getElementById('limpezaFrequencia').value);
      dbConfig.diasManter = parseInt(document.getElementById('diasManter').value);
      
      const frequencias = {
        1: 'di√°rio',
        3: 'a cada 3 dias',
        7: 'semanal',
        15: 'quinzenal',
        30: 'mensal'
      };

      const periodos = {
        7: '7 dias',
        15: '15 dias',
        30: '30 dias',
        60: '60 dias',
        90: '90 dias',
        365: '1 ano'
      };
      
      toast.info('Configura√ß√£o Salva', 
        `Limpeza ${frequencias[dbConfig.limpezaFrequencia]}, manter ${periodos[dbConfig.diasManter]}`);
      
      salvarConfiguracao();
    }

    async function executarLimpeza() {
      if (!dbStatus.conectado) {
        toast.warning('Servidor Desconectado', 'Conecte ao servidor antes de fazer limpeza');
        return;
      }

      const dias = dbConfig.diasManter;
      if (!confirm(`Tem certeza que deseja remover dados anteriores a ${dias} dias?`)) {
        return;
      }

      const btn = event.target;
      const icon = document.getElementById('cleanIcon');
      const text = document.getElementById('cleanText');
      
      btn.disabled = true;
      icon.innerHTML = '<span class="loading"></span>';
      text.textContent = 'Limpando...';

      try {
        console.log(`Iniciando limpeza de dados anteriores a ${dias} dias...`);
        
        const response = await fetch(getApiUrl('/api/cleanup/execute'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            days_to_keep: dias
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          icon.textContent = '‚úÖ';
          text.textContent = 'Limpeza Conclu√≠da';
          toast.success('Limpeza Conclu√≠da', 
            `${data.records_removed} registros removidos`);
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
        
      } catch (error) {
        console.error(`Erro na limpeza: ${error.message}`);
        icon.textContent = '‚ùå';
        text.textContent = 'Erro na Limpeza';
        toast.error('Erro de Limpeza', `${error.message}`);
      } finally {
        setTimeout(() => {
          btn.disabled = false;
          icon.textContent = 'üßπ';
          text.textContent = 'Executar Limpeza Agora';
        }, 3000);
      }
    }

    // ========== FUN√á√ïES DE CONFIGURA√á√ÉO ==========
    async function salvarConfiguracao() {
      try {
        // Salvar localmente
        const configLocal = JSON.stringify(dbConfig);
        localStorage.setItem('dbConfig', configLocal);
        
        if (dbStatus.conectado) {
          // Configurar backup autom√°tico no servidor
          await fetch(getApiUrl('/api/backup/configure'), {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              enabled: dbConfig.backupAuto,
              schedule_time: dbConfig.backupHorario,
              frequency_days: dbConfig.backupFrequencia
            })
          });

          // Configurar limpeza autom√°tica no servidor
          await fetch(getApiUrl('/api/cleanup/configure'), {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              enabled: dbConfig.limpezaAuto,
              frequency_days: dbConfig.limpezaFrequencia,
              days_to_keep: dbConfig.diasManter
            })
          });

          // Salvar configura√ß√µes gerais
          await fetch(getApiUrl('/api/config/save'), {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(dbConfig)
          });
          
          console.log('Configura√ß√µes salvas no servidor');
        }
        
        console.log('Configura√ß√µes salvas localmente');
      } catch (error) {
        console.error(`Erro ao salvar configura√ß√µes: ${error.message}`);
        toast.error('Erro de Configura√ß√£o', 'Falha ao salvar configura√ß√µes');
      }
    }

    async function carregarConfiguracao() {
      try {
        // Carregar configura√ß√µes locais
        const configSalva = localStorage.getItem('dbConfig');
        if (configSalva) {
          dbConfig = { ...dbConfig, ...JSON.parse(configSalva) };
          console.log('Configura√ß√µes carregadas localmente');
          aplicarConfiguracaoInterface();
        }
        
        // Verificar servidor e carregar configura√ß√µes remotas
        if (await verificarStatusServidor()) {
          try {
            const response = await fetch(getApiUrl('/api/config/load'));
            if (response.ok) {
              const data = await response.json();
              if (data.config && Object.keys(data.config).length > 0) {
                // Mesclar configura√ß√µes do servidor
                Object.keys(data.config).forEach(key => {
                  if (dbConfig.hasOwnProperty(key)) {
                    dbConfig[key] = data.config[key];
                  }
                });
                console.log('Configura√ß√µes carregadas do servidor');
                aplicarConfiguracaoInterface();
              }
            }
          } catch (error) {
            console.log('Servidor n√£o dispon√≠vel para carregar configura√ß√µes');
          }
        }
        
      } catch (error) {
        console.error(`Erro ao carregar configura√ß√µes: ${error.message}`);
        toast.warning('Configura√ß√µes', 'Usando configura√ß√µes padr√£o');
      }
    }

    function aplicarConfiguracaoInterface() {
      document.getElementById('dbHost').value = dbConfig.host;
      document.getElementById('dbPort').value = dbConfig.port;

      document.getElementById('backupAuto').checked = dbConfig.backupAuto;
      document.getElementById('backupAutoLabel').textContent = 
        dbConfig.backupAuto ? 'Habilitado' : 'Desabilitado';

      document.getElementById('backupFrequencia').value = dbConfig.backupFrequencia;
      document.getElementById('backupHorario').value = dbConfig.backupHorario;

      document.getElementById('limpezaAuto').checked = dbConfig.limpezaAuto;
      document.getElementById('limpezaAutoLabel').textContent = 
        dbConfig.limpezaAuto ? 'Habilitado' : 'Desabilitado';

      document.getElementById('limpezaFrequencia').value = dbConfig.limpezaFrequencia;
      document.getElementById('diasManter').value = dbConfig.diasManter;

      atualizarStatusInterface();
    }

    // ========== FUN√á√ïES DE STATUS DE CONEX√ÉO ==========

    // Fun√ß√£o Para Verificar Conex√£o Com a Rede WiFi Espec√≠fica
    async function verificarConexaoViza() {
      // Se j√° sabemos que n√£o h√° internet, n√£o adianta tentar
      if (!navigator.onLine) {
        return false;
      }

      try {
        // Verificar se √© poss√≠vel acessar o sistema Viza
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 4000); // Aumentado para 4 segundos

        const response = await fetch('/estado', {
          method: 'GET',
          signal: controller.signal,
          cache: 'no-cache'
        });
        clearTimeout(timeoutId);

        if (response.ok) {
          tentativasFalhas = 0; // Resetar contador em caso de sucesso
          return true;
        } else {
          tentativasFalhas++;
          return false;
        }
      } catch (error) {
        tentativasFalhas++;
        console.log(`Erro na verifica√ß√£o de conex√£o (tentativa ${tentativasFalhas}):`, error.name);
        // S√≥ retorna 'false' de fato ap√≥s 3 tentativas
        if (tentativasFalhas < 6) {
          return true; // Finge que est√° online para ser mais tolerante
        }
        console.log('Erro na verifica√ß√£o de conex√£o:', error.name);
        return false;
      }
    }

    // Fun√ß√£o Para Atualizar Status da Conex√£o
    async function atualizarStatusConexao() {
      if (verificandoConexao) return;
      verificandoConexao = true;

      try {
        const conectadoViza = await verificarConexaoViza();
        const statusElement = document.getElementById('status-conexao');
        const statusText = document.getElementById('status-text');
        
        if (statusElement) {
          if (conectadoViza && !statusConexao) {
            // Conectou √† rede Viza
            statusText.textContent = 'Conectado';
            statusElement.className = 'status-conexao status-online';
            
            // Remover toast de conex√£o perdida se existir
            if (toastConexaoId) {
              toast.remove(toastConexaoId);
              toastConexaoId = null;
            }
            
            toast.success('Conectado √† rede Ilumina√ß√£o_Viza', 'Sistema de ilumina√ß√£o dispon√≠vel');

          } else if (!conectadoViza && statusConexao) {
            // Perdeu conex√£o com a rede Viza
            statusText.textContent = 'Desconectado';
            statusElement.className = 'status-conexao status-offline';
            
            toastConexaoId = toast.error('Fora da rede Ilumina√ß√£o_Viza', 'Conecte-se √† rede WiFi "Ilumina√ß√£o_Viza" para controlar o sistema', {
              persistent: true,
              action: {
                text: 'Tentar Novamente',
                callback: () => {
                  atualizarStatusConexao();
                  toast.info('Verificando...', 'Tentando conectar √† rede Ilumina√ß√£o_Viza');
                }
              }
            });
          }
          
          statusConexao = conectadoViza;
        }
      } catch (error) {
        console.error('Erro ao verificar status:', error);
      } finally {
        verificandoConexao = false;
      }
    }

    // Atualiza√ß√£o de status em tempo real
    function atualizarStatusTempoReal() {
      // Verificar status da conex√£o com a rede Viza a cada 2 segundos
      setInterval(atualizarStatusConexao, 2000);
    }

    // Monitoramento de rede aprimorado
    function monitorarConexao() {
      // Verificar mudan√ßas na conectividade geral
      window.addEventListener('online', () => {
        setTimeout(atualizarStatusConexao, 1000); // Aguardar 1 segundo e verificar
      });
      
      window.addEventListener('offline', () => {
        if (statusConexao) {
          const statusElement = document.getElementById('status-conexao');
          const statusText = document.getElementById('status-text');
          
          statusText.textContent = 'Desconectado';
          statusElement.className = 'status-conexao status-offline';
          
          toast.warning('Sem Conex√£o com Internet', 'Verifique sua conectividade', {
            persistent: true
          });
          
          statusConexao = false;
        }
      });

      // Verificar quando a p√°gina ganha foco (usu√°rio volta ao app)
      window.addEventListener('focus', () => {
        setTimeout(atualizarStatusConexao, 500);
      });

      // Verificar quando h√° mudan√ßa de visibilidade da p√°gina
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) {
          setTimeout(atualizarStatusConexao, 500);
        }
      });
    }

    // ========== INICIALIZA√á√ÉO ==========
    
    // Event listener para DOMContentLoaded
    document.addEventListener('DOMContentLoaded', async function() {
      console.log('Interface de configura√ß√£o do banco carregada');
      
      await carregarConfiguracao();
      await verificarStatusServidor();
      atualizarStatusInterface();
      
      setTimeout(() => {
        if (dbStatus.conectado) {
          toast.success('Sistema Conectado', 'Servidor Python conectado e pronto para uso');
        } else {
          toast.info('Sistema Carregado', 'Configure e conecte ao servidor Python');
        }
      }, 1000);
      
      console.log('Sistema de configura√ß√£o pronto para uso');

      // Event listeners para salvar automaticamente
      document.getElementById('dbHost').addEventListener('change', function() {
        dbConfig.host = this.value;
        salvarConfiguracao();
      });

      document.getElementById('dbPort').addEventListener('change', function() {
        dbConfig.port = parseInt(this.value);
        salvarConfiguracao();
      });
      
      // Verificar status periodicamente (a cada 30 segundos)
      setInterval(verificarStatusServidor, 30000);
    });
    
    // Inicializar monitoramento de conex√£o com a rede
    atualizarStatusTempoReal();
    monitorarConexao();
    
    // Verificar status inicial da conex√£o
    setTimeout(atualizarStatusConexao, 1000);

    // ========== ATALHOS DE TECLADO ==========
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey && e.key === 'c') {
        e.preventDefault();
        criarBanco();
      }
      
      if (e.ctrlKey && e.key === 'Enter') {
        e.preventDefault();
        iniciarBanco();
      }
      
      if (e.ctrlKey && e.key === 'b') {
        e.preventDefault();
        fazerBackupManual();
      }

      if (e.ctrlKey && e.key === 'l') {
        e.preventDefault();
        executarLimpeza();
      }
    });

    // ========== TRATAMENTO DE ERROS ==========
    window.addEventListener('error', function(e) {
      console.error(`Erro na interface: ${e.message}`);
      toast.error('Erro do Sistema', 'Problema detectado na interface');
    });

    window.addEventListener('beforeunload', function(e) {
      salvarConfiguracao();
    });

  </script>

</body>
</html>
