<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <!-- VIEWPORT ÚNICA E OTIMIZADA PARA PWA MOBILE -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- TEMA E ICONE -->
  <meta name="theme-color" content="#8e44ad" />
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <!-- BIBLIOTECA PDF -->  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <!-- TITULO DA GUIA -->
  <title>Sistema De Iluminação Viza Atacadista</title>
  <style>
      * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: #333;
      min-height: 100vh;
      line-height: 1.6;
    }
    
    /* Espaço para menu inferior apenas em mobile */
    @media (max-width: 767px) {
      body {
        padding-bottom: 80px;
      }
    }

        /* ========== SISTEMA DE NOTIFICAÇÕES TOAST ========== */
    
    /* Container das notificações */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 400px;
      pointer-events: none;
    }

    /* Estilo base do toast */
    .toast {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      max-width: 350px;
      min-width: 320px;
      transform: translateX(100%);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      pointer-events: auto;
      position: relative;
      overflow: hidden;
    }

    /* Toast visível */
    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    /* Toast saindo */
    .toast.hide {
      transform: translateX(100%);
      opacity: 0;
      margin-bottom: -80px;
    }

    /* Ícones dos toasts */
    .toast-icon {
      font-size: 20px;
      flex-shrink: 0;
      margin-top: 2px;
    }

    /* Conteúdo do toast */
    .toast-content {
      flex: 1;
      min-width: 0;
    }

    .toast-title {
      font-weight: 600;
      font-size: 14px;
      margin: 0 0 4px 0;
      color: #2c3e50;
      line-height: 1.3;
    }

    .toast-message {
      font-size: 13px;
      color: #64748b;
      margin: 0;
      line-height: 1.4;
    }

    /* Botão de fechar */
    .toast-close {
      background: none;
      border: none;
      color: #94a3b8;
      cursor: pointer;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .toast-close:hover {
      background: rgba(0, 0, 0, 0.1);
      color: #64748b;
    }

    /* Barra de progresso */
    .toast-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 3px;
      background: currentColor;
      border-radius: 0 0 12px 12px;
      opacity: 0.3;
      transition: width linear;
    }

    .toast.success {
      border-left: 4px solid #10b981;
    }
    .toast.success .toast-icon { color: #10b981; }
    .toast.success .toast-progress { background: #10b981; }

    .toast.error {
      border-left: 4px solid #ef4444;
    }
    .toast.error .toast-icon { color: #ef4444; }
    .toast.error .toast-progress { background: #ef4444; }

    .toast.warning {
      border-left: 4px solid #f59e0b;
    }
    .toast.warning .toast-icon { color: #f59e0b; }
    .toast.warning .toast-progress { background: #f59e0b; }

    .toast.info {
      border-left: 4px solid #3b82f6;
    }
    .toast.info .toast-icon { color: #3b82f6; }
    .toast.info .toast-progress { background: #3b82f6; }

    .toast.system {
      border-left: 4px solid #8b5cf6;
    }
    .toast.system .toast-icon { color: #8b5cf6; }
    .toast.system .toast-progress { background: #8b5cf6; }

    /* ========== MENU INFERIOR ESTILO APP ========== */
    
    /* ========== NAVEGAÇÃO NO CABEÇALHO ========== */
    .bottom-nav {
      display: none; /* Oculto por padrão no desktop */
    }
    
    @media (max-width: 767px) {
      .bottom-nav {
        display: block; /* Mostrar apenas no mobile */
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        padding: 8px 0;
        z-index: 1000;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        margin-top: 0;
      }
    }
    
    .nav-container {
      display: flex;
      justify-content: space-around;
      align-items: center;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px 8px;
      text-decoration: none;
      color: #666;
      border-radius: 12px;
      transition: all 0.3s ease;
      min-width: 60px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .nav-item.active {
      color: #8e44ad;
      background: rgba(142, 68, 173, 0.1);
    }
    
    .nav-item:hover {
      color: #8e44ad;
      background: rgba(142, 68, 173, 0.05);
    }
    
    .nav-icon {
      font-size: 20px;
      margin-bottom: 2px;
      line-height: 1;
    }
    
    .nav-label {
      font-size: 10px;
      font-weight: 500;
      text-align: center;
      line-height: 1.2;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      padding: 15px 20px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      position: sticky;
      top: 0;
      z-index: 999;
      gap: 20px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
      flex: 0 0 auto;
    }
    
    .header-center {
      flex: 0 0 auto;
      text-align: left;
      margin-left: 40px;
    }
    
    .header-title-section {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 2px;
    }
    
    .header-title {
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
      margin: 0;
      line-height: 1.2;
    }
    
    .header-subtitle {
      font-size: 12px;
      color: #6c757d;
      margin: 0;
      font-weight: 500;
      text-align: left;
      margin-left: 0;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex: 1;
      gap: 25px;
    }
    
    .header-nav-section {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
      justify-content: center;
    }
    
    .header-logo-right {
      flex: 0 0 auto;
    }

    .logo {
      height: 40px;
      object-fit: contain;
    }
    
    nav a {
      margin: 0 8px;
      text-decoration: none;
      color: #333;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      display: inline-block;
      font-size: 14px;
    }
    
    nav a:hover {
      background: rgba(142,68,173,0.1);
      color: #8e44ad;
    }

    /* Status da conexão no header */
    .status-conexao {
      font-size: 11px;
      font-weight: 700;
      transition: all 0.3s ease;
      white-space: nowrap;
      padding: 4px 8px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    
    .status-online {
      color: #10b981;
    }
    
    .status-offline {
      color: #ef4444;
    }
    
    .status-connecting {
      color: #fbbf24;
    }

    /* Container principal */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px;
      margin-left: 280px; /* Adiciona margem esquerda para dar espaço ao índice */
    }

    /* Índice flutuante */
    .floating-index {
      position: fixed;
      top: 50%;
      left: 20px;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      z-index: 1000;
      max-height: 70vh;
      overflow-y: auto;
      width: 240px;
      transition: all 0.3s ease;
      
      /* Ocultar barra de rolagem */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* Internet Explorer 10+ */
    }

    /* Ocultar barra de rolagem no WebKit (Chrome, Safari, Edge) */
    .floating-index::-webkit-scrollbar {
      display: none;
    }

    .floating-index.collapsed {
      transform: translateY(-50%) translateX(-210px);
    }

    .index-toggle {
      position: absolute;
      top: 20px;
      right: -40px;
      background: #8e44ad;
      color: white;
      border: none;
      border-radius: 0 8px 8px 0;
      padding: 10px 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .index-toggle:hover {
      background: #7b2cbf;
    }

    .index-title {
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 15px;
      text-align: center;
      border-bottom: 2px solid #8e44ad;
      padding-bottom: 8px;
    }

    .index-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .index-item {
      margin-bottom: 8px;
    }

    .index-link {
      display: block;
      padding: 8px 12px;
      color: #495057;
      text-decoration: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .index-link:hover {
      background: rgba(142, 68, 173, 0.1);
      color: #8e44ad;
      border-left-color: #8e44ad;
    }

    .index-link.active {
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      color: white;
      border-left-color: #7b2cbf;
    }

    /* Título principal */
    .main-title {
      text-align: center;
      margin-bottom: 40px;
      color: #2c3e50;
    }

    .main-title h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin: 0 0 10px 0;
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .main-title p {
      font-size: 1.2rem;
      color: #6c757d;
      margin: 0;
    }

    /* Seções do manual */
    .manual-section {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.18);
      transition: all 0.3s ease;
      scroll-margin-top: 100px;
    }

    .manual-section:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
    }

    .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #2c3e50;
      margin: 0 0 20px 0;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      padding-bottom: 10px;
      border-bottom: 2px solid #e9ecef;
    }

    .section-title::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 60px;
      height: 2px;
      background: linear-gradient(90deg, #8e44ad, #9b59b6);
    }

    .section-icon {
      font-size: 1.5rem;
      padding: 8px;
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      color: white;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    /* Subsseções */
    .subsection {
      margin: 25px 0;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      border-radius: 12px;
      border-left: 4px solid #8e44ad;
    }

    .subsection-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #495057;
      margin: 0 0 15px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Sistema de containers - para esquemas de ligação */
    .sistema-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 30px;
      margin: 30px 0;
    }

    .sistema-card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border-left: 4px solid #8e44ad;
    }

    .sistema-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #2c3e50;
      margin: 0 0 20px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Componentes grid - para visualização de componentes */
    .componentes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .componente-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-left: 4px solid #8e44ad;
      transition: all 0.3s ease;
    }

    .componente-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .componente-icon {
      font-size: 2rem;
      padding: 12px;
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      color: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 60px;
      height: 60px;
      flex-shrink: 0;
    }

    .componente-info h4 {
      margin: 0 0 8px 0;
      color: #2c3e50;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .componente-info p {
      margin: 0;
      color: #6c757d;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    /* Sistema de abas - para esquemas de ligação */
    .tab-container {
      margin: 20px 0;
    }

    .tab-buttons {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 12px 20px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      font-weight: 600;
      color: #495057;
      transition: all 0.3s ease;
    }

    .tab-button.active {
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      color: white;
      border-color: #8e44ad;
    }

    .tab-content {
      display: none;
      background: white;
      padding: 25px;
      border: 2px solid #8e44ad;
      border-radius: 0 12px 12px 12px;
    }

    .tab-content.active {
      display: block;
    }

    /* Diagramas de pinagem */
    .pin-diagram {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin: 15px 0;
      font-family: monospace;
      font-size: 0.9rem;
    }

    .pin-esp32 {
      background: #4a90e2;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin: 10px 0;
      text-align: center;
    }

    .pin-connection {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 15px;
      border-bottom: 1px solid #dee2e6;
      position: relative;
      min-height: 30px;
    }
    
    .pin-connection > span:nth-child(2) {
      position: absolute;
      left: 45%;
      transform: translateX(-50%);
      font-size: 1.2em;
      color: #6c757d;
      font-weight: bold;
      background: #f8f9fa;
      padding: 0 10px;
      z-index: 1;
    }

    .pin-left {
      color: #8e44ad;
      font-weight: bold;
    }

    .pin-right {
      color: #10b981;
      font-weight: bold;
    }

    /* Tabelas de especificações */
    .especificacoes-tabela {
      overflow-x: auto;
      margin: 20px 0;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .especificacoes-tabela table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    .especificacoes-tabela thead tr {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
    }

    .especificacoes-tabela th,
    .especificacoes-tabela td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .especificacoes-tabela tbody tr:nth-child(even) {
      background: #f8f9fa;
    }

    .especificacoes-tabela tbody tr:hover {
      background: rgba(142, 68, 173, 0.05);
    }

    /* Listas de passos */
    .step-list {
      counter-reset: step-counter;
      list-style: none;
      padding: 0;
      margin: 20px 0;
    }

    .step-item {
      counter-increment: step-counter;
      margin-bottom: 15px;
      padding: 15px 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-left: 4px solid #fbbf24;
      position: relative;
      transition: all 0.3s ease;
    }

    .step-item:hover {
      transform: translateX(5px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .step-item::before {
      content: counter(step-counter);
      position: absolute;
      left: -12px;
      top: 15px;
      background: #fbbf24;
      color: white;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }

    .step-title {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 8px;
    }

    .step-description {
      color: #6c757d;
      line-height: 1.5;
    }

    /* Caixas de destaque */
    .highlight-box {
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border-left: 4px solid;
      position: relative;
      backdrop-filter: blur(5px);
    }

    .highlight-box.tip {
      background: rgba(16, 185, 129, 0.1);
      border-left-color: #10b981;
      color: #065f46;
    }

    .highlight-box.warning {
      background: rgba(245, 158, 11, 0.1);
      border-left-color: #f59e0b;
      color: #92400e;
    }

    .highlight-box.danger {
      background: rgba(239, 68, 68, 0.1);
      border-left-color: #ef4444;
      color: #991b1b;
    }

    .highlight-box.info {
      background: rgba(59, 130, 246, 0.1);
      border-left-color: #3b82f6;
      color: #1e40af;
    }

    .highlight-box-icon {
      font-size: 1.2rem;
      margin-right: 10px;
    }

    .highlight-box-title {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }

    /* Demonstrações visuais */
    .demo-container {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 2px dashed #dee2e6;
      text-align: center;
    }

    .demo-title {
      font-weight: 600;
      color: #495057;
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .demo-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .demo-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .demo-btn.manual {
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      color: white;
    }

    .demo-btn.automatico {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
    }

    .demo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .demo-status {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 500;
      display: inline-block;
    }

    .demo-status.manual {
      background: rgba(142, 68, 173, 0.1);
      color: #8e44ad;
      border: 1px solid rgba(142, 68, 173, 0.2);
    }

    .demo-status.automatico {
      background: rgba(251, 191, 36, 0.1);
      color: #f59e0b;
      border: 1px solid rgba(251, 191, 36, 0.2);
    }

    /* Slider de demonstração */
    .demo-slider-container {
      margin: 20px 0;
      padding: 20px;
      background: white;
      border-radius: 12px;
      border: 1px solid #e9ecef;
    }

    .demo-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 8px;
      border-radius: 20px;
      outline: none;
      transition: all 0.3s ease;
      background: linear-gradient(to right, #8e44ad 0%, #8e44ad 50%, #e0e0e0 50%, #e0e0e0 100%);
      margin: 10px 0;
    }

    .demo-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(142,68,173,0.4);
    }

    .demo-value {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: #8e44ad;
      margin-top: 10px;
    }

    /* FAQ */
    .faq-item {
      margin-bottom: 15px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .faq-question {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
      border: none;
      width: 100%;
      text-align: left;
      font-size: 1rem;
      font-weight: 600;
      color: #2c3e50;
    }

    .faq-question:hover {
      background: linear-gradient(135deg, #e9ecef, #dee2e6);
    }

    .faq-question.active {
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      color: white;
    }

    .faq-icon {
      font-size: 1.2rem;
      transition: transform 0.3s ease;
    }

    .faq-question.active .faq-icon {
      transform: rotate(180deg);
    }

    .faq-answer {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
      background: white;
    }

    .faq-answer.active {
      padding: 20px;
      max-height: 500px;
    }

    .faq-answer p {
      margin: 0;
      color: #6c757d;
      line-height: 1.6;
    }

    /* Troubleshooting */
    .troubleshoot-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      margin-bottom: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      border-left: 4px solid #ef4444;
    }

    .troubleshoot-icon {
      font-size: 1.5rem;
      color: #ef4444;
      margin-top: 5px;
    }

    .troubleshoot-content h4 {
      margin: 0 0 10px 0;
      color: #2c3e50;
      font-weight: 600;
    }

    .troubleshoot-content p {
      margin: 0;
      color: #6c757d;
      line-height: 1.5;
    }

    /* ========== BARRA DE PESQUISA ========== */
    .search-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(15px);
      border-radius: 16px;
      padding: 25px 30px;
      margin: 25px 0 30px 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(142, 68, 173, 0.1);
    }
    .search-box {
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .search-icon {
      font-size: 24px;
      color: #8e44ad;
      flex-shrink: 0;
    }
    .search-input {
      flex: 1;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 14px 45px 14px 20px;
      font-size: 16px;
      font-family: inherit;
      transition: all 0.3s ease;
      background: white;
      color: #2c3e50;
      outline: none;
    }
    .search-input:focus {
      border-color: #8e44ad;
      box-shadow: 0 0 0 4px rgba(142, 68, 173, 0.1);
    }
    .search-input::placeholder {
      color: #94a3b8;
    }
    .search-clear {
      position: absolute;
      right: 15px;
      background: none;
      border: none;
      font-size: 20px;
      color: #94a3b8;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: all 0.2s ease;
      display: none;
    }
    .search-clear.visible {
      display: block;
    }
    .search-clear:hover {
      background: rgba(0, 0, 0, 0.05);
      color: #64748b;
    }
    .search-results-info {
      margin-top: 12px;
      font-size: 13px;
      color: #64748b;
      display: none;
      align-items: center;
      gap: 10px;
    }
    .search-results-info.visible {
      display: flex;
    }
    .search-navigation {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: auto;
    }
    .search-nav-btn {
      background: #8e44ad;
      color: white;
      border: none;
      border-radius: 6px;
      width: 30px;
      height: 30px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .search-nav-btn:hover:not(:disabled) {
      background: #7b2cbf;
      transform: translateY(-1px);
    }
    .search-nav-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      opacity: 0.5;
    }
    .search-counter {
      font-weight: 600;
      color: #8e44ad;
      min-width: 60px;
      text-align: center;
    }
    .search-highlight {
      background: linear-gradient(120deg, #ffd700 0%, #ffed4e 100%);
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 600;
      color: #2c3e50;
      transition: all 0.3s ease;
    }
    .search-highlight.active {
      background: linear-gradient(120deg, #8e44ad 0%, #9b59b6 100%);
      color: white;
      padding: 3px 6px;
      box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.2);
      transform: scale(1.1);
    }

    /* Botão de download PDF */
    .download-pdf-btn {
      position: fixed;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #8e44ad, #7b2cbf);
      color: white;
      border: none;
      border-radius: 12px 0 0 12px;
      padding: 15px 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 8px 32px rgba(142, 68, 173, 0.4);
      transition: all 0.3s ease;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      min-height: 80px;
      justify-content: center;
      writing-mode: vertical-rl;
      text-orientation: mixed;
    }

    .download-pdf-btn:hover {
      transform: translateY(-50%) translateX(5px);
      box-shadow: 0 12px 40px rgba(142, 68, 173, 0.6);
      background: linear-gradient(135deg, #7b2cbf, #6f42c1);
    }

    .download-pdf-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: translateY(-50%);
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }

    .download-pdf-icon {
      font-size: 18px;
      margin-bottom: 5px;
    }

    .download-pdf-text {
      font-size: 11px;
      text-align: center;
      line-height: 1.2;
    }

    /* Loader para PDF */
    .pdf-loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Modal de progresso do PDF */
    .pdf-progress-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .pdf-progress-content {
      background: white;
      border-radius: 16px;
      padding: 30px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .pdf-progress-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 15px;
    }

    .pdf-progress-bar-container {
      background: #e9ecef;
      border-radius: 10px;
      height: 8px;
      margin: 20px 0;
      overflow: hidden;
    }

    .pdf-progress-bar {
      background: linear-gradient(135deg, #8e44ad, #9b59b6);
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
    }

    .pdf-progress-text {
      color: #6c757d;
      font-size: 14px;
      margin-top: 10px;
    }

    /* Ajustes para impressão/PDF */
    @media print, (max-width: 0) {
      .floating-index,
      .download-pdf-btn,
      .toast-container,
      .demo-container,
      .pdf-progress-modal,
      header nav {
        display: none !important;
      }
      
      header {
        padding: 10px 15px !important;
        background: white !important;
        box-shadow: none !important;
        border-bottom: 2px solid #8e44ad !important;
        position: static !important;
      }
      
      body {
        background: white !important;
        font-size: 12px !important;
        line-height: 1.4 !important;
      }
      
      .manual-section {
        page-break-inside: avoid;
        margin-bottom: 20px !important;
        background: white !important;
        box-shadow: none !important;
        border: 1px solid #dee2e6 !important;
        padding: 15px !important;
      }
      
      .container {
        max-width: none !important;
        padding: 10px !important;
        margin-left: 0 !important;
      }
      
      .main-title {
        margin-bottom: 20px !important;
      }
      
      .main-title h1 {
        color: #2c3e50 !important;
        -webkit-text-fill-color: #2c3e50 !important;
        font-size: 1.8rem !important;
      }
      
      .main-title p {
        color: #6c757d !important;
        font-size: 1rem !important;
      }
      
      .section-title {
        font-size: 1.2rem !important;
        color: #2c3e50 !important;
      }
      
      .section-icon {
        background: #8e44ad !important;
        color: white !important;
      }
      
      .subsection-title {
        font-size: 1rem !important;
        color: #495057 !important;
      }
      
      .highlight-box {
        border: 1px solid #dee2e6 !important;
        background: #f8f9fa !important;
        page-break-inside: avoid;
      }
      
      .step-list {
        page-break-inside: avoid;
      }
      
      .step-item {
        break-inside: avoid;
        margin-bottom: 10px !important;
        padding: 10px !important;
        background: white !important;
        border: 1px solid #dee2e6 !important;
      }
      
      .faq-item {
        page-break-inside: avoid;
        margin-bottom: 10px !important;
        background: white !important;
        border: 1px solid #dee2e6 !important;
      }
      
      .faq-question {
        background: #f8f9fa !important;
        color: #2c3e50 !important;
        padding: 10px !important;
      }
      
      .faq-answer {
        padding: 10px !important;
        background: white !important;
        display: block !important;
        max-height: none !important;
      }
      
      .troubleshoot-item {
        page-break-inside: avoid;
        border: 1px solid #dee2e6 !important;
        background: white !important;
      }

      .tab-content {
        display: block !important;
        border: 1px solid #dee2e6 !important;
        margin-bottom: 15px !important;
      }

      .tab-buttons {
        display: none !important;
      }
    }

    @media (max-width: 1024px) {
      .floating-index {
        position: static;
        transform: none;
        width: 100%;
        margin-bottom: 30px;
      }

      .floating-index.collapsed {
        transform: none;
        display: none;
      }

      .index-toggle {
        display: none;
      }

      .container {
        padding: 20px;
        margin-left: 0;
      }
      
      .download-pdf-btn {
        position: static;
        transform: none;
        writing-mode: horizontal-tb;
        text-orientation: mixed;
        border-radius: 12px;
        margin: 20px auto;
        display: flex;
        flex-direction: row;
        width: auto;
        min-height: auto;
        padding: 12px 20px;
        gap: 10px;
      }
      
      .download-pdf-text {
        font-size: 14px;
      }

      .sistema-container {
        grid-template-columns: 1fr;
      }
      
      .componentes-grid {
        grid-template-columns: 1fr;
      }
      
      .componente-item {
        flex-direction: column;
        text-align: center;
        align-items: center;
      }

      .tab-buttons {
        flex-direction: column;
      }

      .tab-button {
        text-align: center;
        border-radius: 8px;
      }

      .tab-content {
        border-radius: 12px;
      }
    }

    /* Responsividade apenas para MOBILE */
    @media (max-width: 767px) {
      body {
        overflow-x: hidden;
      }
      
      * {
        max-width: 100%;
      }
      
      .toast-container {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
      }
      
      .toast {
        min-width: auto;
        max-width: none;
        font-size: 12px;
        padding: 12px 16px;
      }

      header {
        padding: 10px 15px;
        gap: 15px;
        flex-direction: column;
      }
      
      /* Reorganizar para mobile: logos primeiro */
      .header-left, .header-right {
        width: auto;
        flex: none;
      }
      
      .header-left {
        order: 1;
        align-self: flex-start;
      }
      
      .header-right {
        order: 2;
        align-self: flex-end;
        position: absolute;
        top: 10px;
        right: 15px;
      }
      
      .header-nav-section {
        display: none; /* Ocultar menu no mobile */
      }
      
      .header-logo-right {
        display: flex;
      }
      
      .header-center {
        order: 3;
        margin-bottom: 0;
        margin-left: 0;
        margin-top: 10px;
        text-align: center;
        width: 100%;
      }
      
      .header-title-section {
        flex-direction: column;
        gap: 8px;
        justify-content: center;
        align-items: center;
      }
      
      .header-title {
        font-size: 16px;
        text-align: center;
        order: 1;
      }
      
      .header-subtitle {
        font-size: 11px;
        text-align: center;
        order: 2;
      }
      
      .status-conexao {
        order: 3;
        font-size: 10px;
        padding: 3px 6px;
        margin-top: 5px;
      }

      header nav {
        display: none; /* Ocultar menu de navegação no mobile */
      }

      .logo {
        height: 32px;
      }

      .container {
        padding: 15px;
        margin-left: 0;
      }

      .manual-section {
        padding: 20px 15px;
      }
      
      .search-container {
        padding: 12px 15px;
        margin: 15px 0 20px 0;
      }
      
      .search-box {
        gap: 8px;
      }
      
      .search-icon {
        font-size: 18px;
      }
      
      .search-input {
        padding: 10px 40px 10px 12px;
        font-size: 14px;
        border-radius: 10px;
      }
      
      .search-clear {
        right: 10px;
        font-size: 16px;
      }
      
      .search-results-info {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        margin-top: 10px;
        font-size: 12px;
      }
      
      .search-navigation {
        margin-left: 0;
        width: 100%;
        justify-content: center;
        gap: 6px;
      }
      
      .search-nav-btn {
        width: 28px;
        height: 28px;
        font-size: 14px;
      }
      
      .search-counter {
        min-width: 45px;
        font-size: 12px;
      }

      .main-title h1 {
        font-size: 2rem;
      }

      .section-title {
        font-size: 1.4rem;
        flex-direction: column;
        text-align: center;
        gap: 8px;
      }

      .demo-buttons {
        flex-direction: column;
        align-items: center;
      }

      .demo-btn {
        width: 200px;
      }

      .step-item {
        margin-left: 10px;
      }

      .troubleshoot-item {
        flex-direction: column;
        text-align: center;
      }
      
      .download-pdf-btn {
        position: fixed;
        top: auto;
        bottom: 80px;
        right: 20px;
        transform: none;
        writing-mode: horizontal-tb;
        border-radius: 12px;
        padding: 10px 15px;
        flex-direction: row;
        gap: 8px;
        min-height: auto;
        width: auto;
      }
      
      .download-pdf-text {
        font-size: 12px;
      }
    }

    /* ========== RESPONSIVIDADE SMARTPHONES PEQUENOS ========== */
    @media (max-width: 480px) {
      .search-container {
        padding: 10px 12px;
        margin: 12px 0 15px 0;
        border-radius: 12px;
      }
      
      .search-box {
        gap: 6px;
      }
      
      .search-icon {
        font-size: 16px;
      }
      
      .search-input {
        padding: 8px 35px 8px 10px;
        font-size: 13px;
        border-radius: 8px;
      }
      
      .search-clear {
        right: 8px;
        font-size: 14px;
        padding: 3px;
      }
      
      .search-results-info {
        gap: 6px;
        margin-top: 8px;
        font-size: 11px;
      }
      
      .search-navigation {
        gap: 4px;
      }
      
      .search-nav-btn {
        width: 26px;
        height: 26px;
        font-size: 13px;
      }
      
      .search-counter {
        min-width: 40px;
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <!-- Container das notificações -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Menus e Logos-->   
  <header>
    <div class="header-left">
      <a href="/"><img src="images/Viza_Logo.png" alt="Viza" class="logo"></a>
    </div>
    
    <div class="header-center">
      <div class="header-title-section">
        <h1 class="header-title">Sistema De Iluminação Viza</h1>
        <!-- Status da conexão -->
        <div id="status-conexao" class="status-conexao status-connecting">
          <span id="status-text">Conectando</span>
        </div>
      </div>
      <p class="header-subtitle">Controle Inteligente De Iluminação</p>
    </div>
    
    <div class="header-right">
      <div class="header-nav-section">
        <nav>
          <a href="/">🏢 Operação</a>
          <a href="/Visualizacao">📊 Visualização</a>
          <a href="/Consumo">⚡ Consumo</a>
          <a href="/Banco">🗄️ Banco</a>
          <a href="/Manual">📖 Manual</a>
        </nav>
      </div>
      
      <div class="header-logo-right">
        <img src="images/Engemase_Logo.png" alt="Engemase" class="logo">
      </div>
    </div>
  </header>

  <!-- Índice flutuante -->
  <div class="floating-index" id="floatingIndex">
    <button class="index-toggle" onclick="toggleIndex()">📖</button>
    <div class="index-title">📚 Índice do Manual</div>
    <ul class="index-list">
      <li class="index-item"><a href="#introducao" class="index-link">🏠 Introdução</a></li>
      <li class="index-item"><a href="#navegacao" class="index-link">🧭 Navegação Básica</a></li>
      <li class="index-item"><a href="#controle-geral" class="index-link">🔧 Controle Geral</a></li>
      <li class="index-item"><a href="#controle-setores" class="index-link">🏭 Controle por Setores</a></li>
      <li class="index-item"><a href="#agendamento" class="index-link">⏰ Agendamentos</a></li>
      <li class="index-item"><a href="#visualizacao" class="index-link">👁️ Visualização</a></li>
      <li class="index-item"><a href="#consumo" class="index-link">⚡ Monitoramento de Consumo</a></li>
      <li class="index-item"><a href="#banco-dados" class="index-link">🗄️ Banco de Dados</a></li>
      <li class="index-item"><a href="#esquema-ligacao" class="index-link">🔌 Esquemas de Ligação</a></li>
      <li class="index-item"><a href="#troubleshooting" class="index-link">🔧 Solução de Problemas</a></li>
      <li class="index-item"><a href="#faq" class="index-link">❓ Perguntas Frequentes</a></li>
      <li class="index-item"><a href="#contato" class="index-link">📞 Suporte Técnico</a></li>
    </ul>
  </div>

  <div class="container">
    <!-- Título Principal -->
    <div class="main-title">
      <h1>📖 Manual de Operação</h1>
      <p>Sistema de Iluminação Viza - Guia Completo para Operadores</p>
    </div>

    <!-- Barra de Pesquisa -->
    <div class="search-container">
      <div class="search-box">
        <span class="search-icon">🔍</span>
        <input 
          type="text" 
          id="searchInput" 
          class="search-input" 
          placeholder="Digite sua busca e pressione ENTER... (Ex: agendamento, controle, consumo)"
          autocomplete="off"
        />
        <button class="search-clear" id="searchClear" onclick="limparPesquisa()">✕</button>
      </div>
      <div class="search-results-info" id="searchResultsInfo">
        <span id="searchResultsText"></span>
        <div class="search-navigation" id="searchNavigation" style="display: none;">
          <button class="search-nav-btn" id="searchPrevBtn" onclick="navegarResultadoAnterior()" title="Resultado anterior (Seta ↑)">↑</button>
          <span class="search-counter" id="searchCounter">0/0</span>
          <button class="search-nav-btn" id="searchNextBtn" onclick="navegarProximoResultado()" title="Próximo resultado (Seta ↓)">↓</button>
        </div>
      </div>
    </div>

    <!-- Seção 1: Introdução -->
    <section class="manual-section" id="introducao">
      <h2 class="section-title">
        <span class="section-icon">🏠</span>
        Introdução ao Sistema
      </h2>
      
      <p>Bem-vindo ao Sistema de Iluminação Viza! Este manual foi elaborado com o objetivo de orientar, de forma clara e acessível, todos os usuários a utilizarem o sistema com praticidade e segurança.</p>
      
      <div class="subsection">
        <h3 class="subsection-title">🎯 O que o Sistema Faz</h3>
        <p>O Sistema Viza controla automaticamente a iluminação de três setores principais:</p>
        <ul>
          <li><strong>🚗 Estacionamento:</strong> 225 luminárias distribuídas em colunas e áreas laterais</li>
          <li><strong>🏪 Loja:</strong> 241 luminárias organizadas em fileiras</li>
          <li><strong>📦 Depósito:</strong> 14 luminárias organizadas em fileiras</li>
        </ul>
      </div>

      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">💡</span>
          Dica Importante
        </div>
        <p>O sistema funciona 24 horas por dia e pode ser controlado remotamente através de qualquer dispositivo conectado na rede (computador, tablet ou celular).</p>
      </div>
    </section>

    <!-- Seção 2: Navegação Básica -->
    <section class="manual-section" id="navegacao">
      <h2 class="section-title">
        <span class="section-icon">🧭</span>
        Navegação Básica
      </h2>
      
      <div class="subsection">
        <h3 class="subsection-title">📱 Acessando o Sistema</h3>
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Abra seu navegador de internet</div>
            <div class="step-description">Use Chrome, Firefox, Safari ou Edge. O sistema funciona em qualquer navegador moderno.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Digite o endereço do sistema</div>
            <div class="step-description">O endereço de acesso será fornecido pelo administrador. Por padrão, utilize: http://192.168.4.1</div>
          </li>
          <li class="step-item">
            <div class="step-title">Aguarde o carregamento</div>
            <div class="step-description">A tela principal aparecerá automaticamente em alguns segundos</div>
          </li>
        </ol>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🎛️ Menu Principal</h3>
        <p>O sistema possui 4 telas principais acessíveis pelo menu superior:</p>
        <ul>
          <li><strong>🔧 Controle:</strong> Para ligar/desligar luminárias e ajustar brilho</li>
          <li><strong>👁️ Visualização:</strong> Para ver o status de todas as luminárias em tempo real</li>
          <li><strong>⚡ Consumo:</strong> Para monitorar gastos de energia e custos</li>
          <li><strong>📖 Manual:</strong> Esta página com instruções completas</li>
        </ul>
      </div>

      <div class="highlight-box info">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">ℹ️</span>
          Status de Conexão
        </div>
        <p>No canto superior direito, você sempre verá um indicador de conexão:</p>
        <ul>
          <li><strong>🟢 Online:</strong> Sistema funcionando normalmente</li>
          <li><strong>🔴 Offline:</strong> Problema de comunicação - verifique a internet</li>
        </ul>
      </div>
    </section>

    <!-- Seção 3: Controle Geral -->
    <section class="manual-section" id="controle-geral">
      <h2 class="section-title">
        <span class="section-icon">🔧</span>
        Controle Geral das Luminárias
      </h2>
      
      <div class="subsection">
        <h3 class="subsection-title">🏢 Controlando Todas as Luminárias</h3>
        <p>Na tela de <strong>Controle</strong>, você encontra a seção "Controle Geral" que permite controlar todas as 480 luminárias de uma vez.</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Modo de Operação:</div>
            <div class="step-description">
              <strong>🤖 Automático:</strong> O sistema opera de forma autônoma, com base nos horários programados e nas leituras do sensor de luminosidade. Ele ajusta o nível de iluminação conforme a necessidade do ambiente, sem intervenção do usuário.  
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Modo de Operação:</div>
            <div class="step-description">
              <strong>🔧 Manual:</strong> Permite que o usuário controle diretamente o nível de iluminação da luminária, definindo a intensidade desejada, independentemente do agendamento ou da luz ambiente.
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Ajuste o Brilho (apenas no Modo Manual)</div>
            <div class="step-description">Use o controle deslizante ou digite um valor de 0% a 100%. Quanto maior o número, mais forte a luz.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Confirme as Mudanças</div>
            <div class="step-description">O sistema aplica as alterações automaticamente e mostra uma notificação de confirmação.</div>
          </li>
        </ol>
      </div>

      <div class="demo-container">
        <div class="demo-title">🎮 Demonstração Interativa - Controle Geral</div>
        <div class="demo-buttons">
          <button class="demo-btn manual" onclick="demonstrarModo('manual')">🔧 Modo Manual</button>
          <button class="demo-btn automatico" onclick="demonstrarModo('automatico')">🤖 Modo Automático</button>
        </div>
        <div id="demoStatus" class="demo-status automatico">🤖 Sistema em Modo Automático</div>
        
        <div id="demoSliderContainer" class="demo-slider-container" style="display: none;">
          <div style="text-align: center; margin-bottom: 10px; font-weight: 600; color: #495057;">
            💡 Controle de Brilho Geral
          </div>
          <input type="range" class="demo-slider" id="demoSlider" min="0" max="100" value="50" onchange="atualizarDemoSlider(this.value)">
          <div class="demo-value" id="demoValue">50%</div>
        </div>
      </div>

      <div class="highlight-box warning">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">⚠️</span>
          Atenção
        </div>
        <p>No Modo Manual, as luminárias permanecem no estado que você definir até que você mude novamente ou volte para o Modo Automático. Certifique-se de que o modo escolhido é adequado para o momento atual.</p>
      </div>
    </section>

    <!-- Seção 4: Controle por Setores -->
    <section class="manual-section" id="controle-setores">
      <h2 class="section-title">
        <span class="section-icon">🏭</span>
        Controle por Setores
      </h2>
      
      <div class="subsection">
        <h3 class="subsection-title">🎯 Controlando Setores Específicos</h3>
        <p>Você pode controlar cada setor independentemente, o que é muito útil quando apenas uma área precisa de ajustes.</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Selecione o Setor</div>
            <div class="step-description">
              Use o menu suspenso para escolher:<br>
              • <strong>🚗 Estacionamento</strong> (225 luminárias)<br>
              • <strong>🏪 Loja</strong> (241 luminárias)<br>
              • <strong>📦 Depósito</strong> (14 luminárias)
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Defina o Modo do Setor</div>
            <div class="step-description">Cada setor pode ter seu próprio modo (Manual ou Automático), independente dos outros setores.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Sobre os Modos do Setor</div>
            <div class="step-description"> No Modo Manual, você pode definir um brilho específico para o setor selecionado. 
            Caso o setor esteja configurado em modo automático, ele ainda poderá ser controlado pelo comando geral. 
            No entanto, se estiver em modo manual, os comandos gerais não terão efeito sobre ele.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Ajuste o Brilho do Setor</div>
            <div class="step-description">No Modo Manual, você pode definir um brilho específico apenas para o setor selecionado.</div>
          </li>
        </ol>
      </div>

      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">💡</span>
          Exemplo Prático
        </div>
        <p><strong>Situação:</strong> Durante o dia, você quer que o estacionamento funcione automaticamente, mas precisa deixar a loja com brilho reduzido para economia.<br><br>
        <strong>Solução:</strong> Deixe o estacionamento em "Modo Automático" e mude apenas a loja para "Modo Manual" com brilho baixo (exemplo: 30%).</p>
      </div>
    </section>

    <!-- Seção 5: Agendamentos -->
    <section class="manual-section" id="agendamento">
      <h2 class="section-title">
        <span class="section-icon">⏰</span>
        Sistema de Agendamentos
      </h2>
      
      <div class="subsection">
        <h3 class="subsection-title">📅 Criando Agendamentos</h3>
        <p>O sistema permite programar horários automáticos para ligar e desligar as luminárias de cada setor.</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Sincronize o Relógio do Sistema</div>
            <div class="step-description">
              Clique no botão "🔄 Sincronizar" para ajustar o relógio interno com a hora atual do seu dispositivo. Isso garante que os agendamentos funcionem corretamente.
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Selecione o Setor para Agendar</div>
            <div class="step-description">Escolha qual setor receberá o agendamento no menu suspenso da seção "Agendamento Por Setores".</div>
          </li>
          <li class="step-item">
            <div class="step-title">Defina os Horários</div>
            <div class="step-description">
              • <strong>🌅 Horário para Ligar:</strong> Quando as luminárias devem acender automaticamente.<br>
              • <strong>🌙 Horário para Desligar:</strong> Quando as luminárias devem apagar automaticamente.<br>
              • <strong>💡 Brilho ao Ligar:</strong> Intensidade da luz quando ligar (0% a 100%).
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Confirme o Agendamento</div>
            <div class="step-description">Clique em "⏰ Agendar" para salvar. O sistema confirmará com uma mensagem de sucesso.</div>
          </li>
        </ol>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📋 Gerenciando Agendamentos Existentes</h3>
        <p>Na tabela "Agendamentos dos Setores", você pode ver e gerenciar todos os agendamentos:</p>
        <ul>
          <li><strong>▶️ Ativar/⏸️ Desativar:</strong> Liga ou desliga um agendamento sem apagá-lo</li>
          <li><strong>🗑️ Limpar:</strong> Remove completamente o agendamento do setor</li>
          <li><strong>Status:</strong> Mostra se o agendamento está ATIVO ou INATIVO</li>
        </ul>
      </div>

      <div class="highlight-box info">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">ℹ️</span>
          Como Funciona na Prática
        </div>
        <p><strong>Exemplo de Agendamento Típico:</strong><br>
        • Setor: 🚗 Estacionamento<br>
        • Ligar: 18:00 com 80% de brilho<br>
        • Desligar: 06:00<br><br>
        <strong>Resultado:</strong> Todos os dias às 18:00, o estacionamento acende automaticamente com 80% de brilho e às 06:00 apaga automaticamente.</p>
      </div>

      <div class="highlight-box warning">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">⚠️</span>
          Importante sobre Agendamentos
        </div>
        <ul>
          <li>Os agendamentos só funcionam quando o setor está em <strong>Modo Automático</strong></li>
          <li>Se um setor estiver em <strong>Modo Manual</strong>, os agendamentos são ignorados</li>
          <li>Sincronize o relógio regularmente para manter a precisão dos horários</li>
        </ul>
      </div>
    </section>

    <!-- Seção 6: Visualização -->
    <section class="manual-section" id="visualizacao">
      <h2 class="section-title">
        <span class="section-icon">👁️</span>
        Tela de Visualização
      </h2>
      
      <div class="subsection">
        <h3 class="subsection-title">📊 Monitoramento em Tempo Real</h3>
        <p>A tela de Visualização mostra o status de todas as luminárias em tempo real, atualizada automaticamente a cada 2 segundos.</p>
        
        <div class="demo-container">
          <div class="demo-title">🎨 Legenda de Status das Luminárias</div>
          <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
            <div style="text-align: center;">
              <div style="width: 60px; height: 30px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 8px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">85%</div>
              <strong>🟢 Ligada</strong><br>
              <small>Funcionando normalmente</small>
            </div>
            <div style="text-align: center;">
              <div style="width: 60px; height: 30px; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 8px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 12px;">0%</div>
              <strong>🔴 Desligada</strong><br>
              <small>Apagada intencionalmente</small>
            </div>
            <div style="text-align: center;">
              <div style="width: 60px; height: 30px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 8px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 10px; animation: piscar 2s infinite;">S/COM</div>
              <strong>🟡 Sem Comunicação</strong><br>
              <small>Problema de conexão</small>
            </div>
          </div>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🧭 Navegando pelos Setores</h3>
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Selecione o Setor</div>
            <div class="step-description">Use os botões superiores: 🚗 Estacionamento, 🏪 Loja ou 📦 Depósito</div>
          </li>
          <li class="step-item">
            <div class="step-title">Escolha a Área (Estacionamento)</div>
            <div class="step-description">
              No estacionamento, você pode ver:<br>
              • <strong>🚗 Geral:</strong> Colunas principais (200 luminárias)<br>
              • <strong>📍 Lateral:</strong> Área lateral (25 luminárias)
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Interprete os Contadores</div>
            <div class="step-description">
              Os números mostram: <strong>ligadas/total</strong><br>
              Exemplo: "185/225" = 185 luminárias ligadas de 225 totais
            </div>
          </li>
        </ol>
      </div>

      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">💡</span>
          Identificando Problemas
        </div>
        <p>Se você ver muitas luminárias em <strong>🟡 Amarelo (S/COM)</strong>, pode indicar:</p>
        <ul>
          <li>Problema na rede elétrica local</li>
          <li>Falha de comunicação</li>
          <li>Manutenção necessária</li>
        </ul>
        <p>Anote os locais afetados e informe ao técnico responsável.</p>
      </div>
    </section>

    <!-- Seção 7: Consumo -->
    <section class="manual-section" id="consumo">
      <h2 class="section-title">
        <span class="section-icon">⚡</span>
        Monitoramento de Consumo
      </h2>
      <div class="subsection">
        <h3 class="subsection-title">💰 Configurando a Tarifa de Energia</h3>
        <p>Configure corretamente a tarifa para cálculos precisos dos custos:</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Encontre o Valor na Conta de Luz</div>
            <div class="step-description">
              Procure na sua conta de energia o valor em R$ por kWh. Geralmente fica entre R$ 0,40 e R$ 0,80 por kWh.
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Configure no Sistema</div>
            <div class="step-description">
              Na seção "💰 Tarifa de Energia (R$/kWh)", digite o valor no campo e clique em "💾 Salvar". O botão mudará de cor para confirmar alterações pendentes.
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Verificação Automática</div>
            <div class="step-description">
              O sistema recalcula automaticamente todos os custos históricos e exibe o valor atual sendo usado nos cálculos abaixo do campo.
            </div>
          </li>
        </ol>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🎯 Filtros e Controles de Visualização</h3>
        <p>Customize a visualização dos dados conforme sua necessidade:</p>
        
        <ul>
          <li><strong>📍 Filtrar por Setor:</strong> Escolha entre Geral (todos), Estacionamento, Loja ou Depósito</li>
          <li><strong>📅 Período:</strong> Selecione Hoje, Semana ou Mês para diferentes análises temporais</li>
          <li><strong>🔄 Atualização:</strong> Dados são atualizados automaticamente a cada minuto</li>
        </ul>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📊 Dashboard de Métricas Reais</h3>
        <p>O painel exibe 4 métricas baseadas exclusivamente em dados do ESP32:</p>
        <ul>
          <li><strong>💡 kWh Atual:</strong> Consumo real registrado pelo sistema</li>
          <li><strong>💰 Custo do Período:</strong> Valor calculado com base na tarifa configurada</li>
          <li><strong>⚡ Eficiência Energética:</strong> Indicador de performance (ideal: acima de 80%)</li>
          <li><strong>⏰ Horas de Operação:</strong> Tempo real de funcionamento das luminárias</li>
        </ul>
        
        <div class="highlight-box tip">
          <div class="highlight-box-title">
            <span class="highlight-box-icon">📈</span>
            Interpretando as Tendências
          </div>
          <p>Cada métrica mostra tendências com ícones:</p>
          <ul>
            <li><strong>↗️ Verde:</strong> Aumento em relação ao período anterior</li>
            <li><strong>↘️ Vermelho:</strong> Redução em relação ao período anterior</li>
            <li><strong>➡️ Neutro:</strong> Valores estáveis (variação menor que 1%)</li>
          </ul>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📈 Gráficos de Análise</h3>
        <p>Dois gráficos mostram os dados reais de forma visual:</p>
        <ul>
          <li><strong>📊 Consumo por Horário:</strong> Gráfico de linha mostrando registros ao longo do tempo</li>
          <li><strong>🥧 Distribuição por Setor:</strong> Gráfico de pizza com percentual de consumo de cada área</li>
        </ul>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📋 Tabela de Registros</h3>
        <p>A tabela "Registros de Consumo Horário" mostra <strong>exclusivamente dados</strong>:</p>
        
        <div class="demo-container">
          <div class="demo-title">📊 Colunas da Tabela Explicadas</div>
          <ul style="text-align: left;">
            <li><strong>⏰ Horário:</strong> Momento exato do registro</li>
            <li><strong>🏢 Setor:</strong> Área monitorada</li>
            <li><strong>💡 Luminárias Ativas:</strong> Quantidade funcionando</li>
            <li><strong>⚡ Consumo (kWh):</strong> Energia real consumida</li>
            <li><strong>💰 Custo (R$):</strong> Valor calculado com a tarifa</li>
            <li><strong>📊 Eficiência (%):</strong> Performance do sistema</li>
            <li><strong>🕐 Status:</strong> Origem do registro</li>
          </ul>
        </div>

        <div class="highlight-box warning">
          <div class="highlight-box-title">
            <span class="highlight-box-icon">🔍</span>
            Status dos Registros
          </div>
          <ul>
            <li><strong>✅ Registrado:</strong> Dado coletado automaticamente pelo ESP32</li>
            <li><strong>🔄 Recuperado:</strong> Horário perdido, preenchido automaticamente pelo sistema</li>
          </ul>
          <p><strong>Sistema de Recuperação:</strong> Se houver falhas na coleta (falta de energia, problemas de rede), o sistema detecta automaticamente e preenche as lacunas com base nos dados atuais disponíveis.</p>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🛠️ Funcionalidades Avançadas</h3>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">📗 Exportar Excel</div>
            <div class="step-description">
              Baixa uma planilha com todos os registros reais do período selecionado, incluindo status de cada registro.
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">🔄 Atualizar Dados</div>
            <div class="step-description">
              Força uma nova coleta de dados do ESP32, útil quando você suspeita que há novos registros disponíveis.
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">🗑️ Resetar Histórico</div>
            <div class="step-description">
              <strong>CUIDADO:</strong> Apaga completamente todo o histórico de dados. Use apenas quando necessário reiniciar a coleta do zero.
            </div>
          </li>
        </ol>
      </div>

      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">💡</span>
          Dicas para Análise Eficiente
        </div>
        <ul>
          <li><strong>Monitore Regularmente:</strong> Verifique os dados semanalmente para identificar padrões</li>
          <li><strong>Compare Setores:</strong> Use o filtro por setor para identificar áreas com maior consumo</li>
          <li><strong>Acompanhe Eficiência:</strong> Valores abaixo de 70% podem indicar problemas técnicos</li>
          <li><strong>Analise Tendências:</strong> Use as setas coloridas para identificar aumentos ou reduções</li>
          <li><strong>Exporte Dados:</strong> Mantenha backups mensais dos dados para análises históricas</li>
          <li><strong>Verifique Recuperações:</strong> Muitos registros "🔄 Recuperados" podem indicar problemas de rede</li>
        </ul>
      </div>

      <div class="highlight-box warning">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">⚠️</span>
          Limitações do Sistema de Dados
        </div>
        <ul>
          <li><strong>Dependência do ESP32:</strong> Sem comunicação com o hardware, não há novos dados</li>
          <li><strong>Coleta Horária:</strong> Dados são registrados a cada hora cheia (ex: 14:00, 15:00)</li>
          <li><strong>Faz Um Previsão:</strong> O sistema faz estimativas - não temos medição real da luminária</li>
          <li><strong>Reset Irreversível:</strong> Dados apagados pelo reset não podem ser recuperados</li>
        </ul>
      </div>
    </section>

    <!-- Seção 8: Banco de Dados -->
    <section class="manual-section" id="banco-dados">
      <h2 class="section-title">
        <span class="section-icon">🗄️</span>
        Configuração do Banco de Dados
      </h2>
      
      <p>O Sistema Viza utiliza um servidor Python separado para armazenar e gerenciar dados históricos de consumo. Esta seção explica como configurar e manter o banco de dados do sistema.</p>

      <div class="highlight-box info">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">ℹ️</span>
          Sobre o Banco de Dados
        </div>
        <p>O banco de dados é um servidor Python independente que roda em paralelo ao sistema ESP32. Ele coleta, armazena e processa dados de consumo energético para análises históricas e relatórios.</p>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🌐 Acessando a Configuração</h3>
        <p>Para acessar as configurações do banco de dados:</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Navegue para a Tela de Consumo</div>
            <div class="step-description">Na tela principal de "📊 Consumo De Energia"</div>
          </li>
          <li class="step-item">
            <div class="step-title">Clique em "Configuração Banco De Dados"</div>
            <div class="step-description">Use o botão cinza "🛠️ Configuração Banco De Dados" na parte inferior</div>
          </li>
          <li class="step-item">
            <div class="step-title">Verifique o Status</div>
            <div class="step-description">A barra de status mostra o estado atual: Banco, Backup, Limpeza e Scheduler</div>
          </li>
        </ol>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">⚙️ Configuração Inicial</h3>
        
        <div class="sistema-container">
          <div class="sistema-card">
            <div class="sistema-title">
              <span style="font-size: 1.5em;">🖥️</span>
              Configuração do Servidor
            </div>
            
            <ol class="step-list">
              <li class="step-item">
                <div class="step-title">Configure o IP do Servidor</div>
                <div class="step-description">
                  <strong>IP Padrão:</strong> 192.168.4.2<br>
                  Digite o endereço IP onde o servidor Python está rodando
                </div>
              </li>
              <li class="step-item">
                <div class="step-title">Configure a Porta</div>
                <div class="step-description">
                  <strong>Porta Padrão:</strong> 5000<br>
                  Mantenha 5000 ou use a porta configurada pelo administrador
                </div>
              </li>
              <li class="step-item">
                <div class="step-title">Crie o Banco (Primeira Vez)</div>
                <div class="step-description">
                  Clique em "🆕 Criar Banco" para inicializar o banco de dados
                </div>
              </li>
              <li class="step-item">
                <div class="step-title">Inicie a Conexão</div>
                <div class="step-description">
                  Clique em "▶️ Iniciar Banco" para conectar ao servidor
                </div>
              </li>
            </ol>
          </div>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">💾 Sistema de Backup</h3>
        <p>Configure backups automáticos para proteger seus dados históricos:</p>
        
        <div class="tab-container">
          <div class="tab-buttons">
            <div class="tab-button active" onclick="showTab('backup-config')">⚙️ Configuração</div>
            <div class="tab-button" onclick="showTab('backup-manual')">🔧 Backup Manual</div>
            <div class="tab-button" onclick="showTab('backup-restaurar')">📥 Restaurar</div>
          </div>

          <div id="tab-backup-config" class="tab-content active">
            <div class="sistema-title">
              <span style="font-size: 1.5em;">⚙️</span>
              Configuração de Backup Automático
            </div>

            <ol class="step-list">
              <li class="step-item">
                <div class="step-title">Ativar Backup Automático</div>
                <div class="step-description">Use a chave deslizante para "Habilitado"</div>
              </li>
              <li class="step-item">
                <div class="step-title">Definir Frequência</div>
                <div class="step-description">
                  • <strong>📅 Diário:</strong> Backup todos os dias<br>
                  • <strong>📈 Semanal:</strong> Uma vez por semana (recomendado)<br>
                  • <strong>📆 Mensal:</strong> Uma vez por mês
                </div>
              </li>
              <li class="step-item">
                <div class="step-title">Configurar Horário</div>
                <div class="step-description">
                  <strong>Padrão:</strong> 02:00 (madrugada)<br>
                  Escolha um horário de baixo uso do sistema
                </div>
              </li>
            </ol>
          </div>

          <div id="tab-backup-manual" class="tab-content">
            <div class="sistema-title">
              <span style="font-size: 1.5em;">🔧</span>
              Fazendo Backup Manual
            </div>

            <ol class="step-list">
              <li class="step-item">
                <div class="step-title">Verificar Conexão</div>
                <div class="step-description">Certifique-se que o status mostra "🟢 Banco: Conectado"</div>
              </li>
              <li class="step-item">
                <div class="step-title">Executar Backup</div>
                <div class="step-description">Clique em "💾 Fazer Backup Agora"</div>
              </li>
              <li class="step-item">
                <div class="step-title">Aguardar Confirmação</div>
                <div class="step-description">O sistema mostrará o nome do arquivo gerado</div>
              </li>
            </ol>

            <div class="highlight-box tip">
              <div class="highlight-box-title">
                <span class="highlight-box-icon">💡</span>
                Quando Fazer Backup Manual
              </div>
              <ul>
                <li>Antes de mudanças importantes no sistema</li>
                <li>Ao final de períodos críticos (mês, trimestre)</li>
                <li>Antes de limpezas automáticas</li>
                <li>Como precaução antes de manutenções</li>
              </ul>
            </div>
          </div>

          <div id="tab-backup-restaurar" class="tab-content">
            <div class="sistema-title">
              <span style="font-size: 1.5em;">📥</span>
              Restaurando Backup
            </div>

            <div class="highlight-box danger">
              <div class="highlight-box-title">
                <span class="highlight-box-icon">⚠️</span>
                ATENÇÃO: Operação Irreversível
              </div>
              <p>Restaurar um backup substitui TODOS os dados atuais. Esta operação não pode ser desfeita!</p>
            </div>

            <ol class="step-list">
              <li class="step-item">
                <div class="step-title">Confirmar Necessidade</div>
                <div class="step-description">Certifique-se que realmente precisa restaurar dados antigos</div>
              </li>
              <li class="step-item">
                <div class="step-title">Obter Nome do Arquivo</div>
                <div class="step-description">Localize o nome exato do arquivo de backup (ex: backup_2024_01_15.db)</div>
              </li>
              <li class="step-item">
                <div class="step-title">Executar Restauração</div>
                <div class="step-description">
                  1. Clique em "📥 Restaurar Backup"<br>
                  2. Digite o nome do arquivo quando solicitado<br>
                  3. Confirme a operação
                </div>
              </li>
              <li class="step-item">
                <div class="step-title">Verificar Resultado</div>
                <div class="step-description">Aguarde a confirmação e verifique se os dados foram restaurados corretamente</div>
              </li>
            </ol>
          </div>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🧹 Limpeza Automática</h3>
        <p>Configure a limpeza automática para otimizar o desempenho e espaço do banco:</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Ativar Limpeza Automática</div>
            <div class="step-description">Use a chave deslizante para "Habilitado"</div>
          </li>
          <li class="step-item">
            <div class="step-title">Configurar Frequência</div>
            <div class="step-description">
              • <strong>🌅 Diário:</strong> Todo dia (para sistemas com muitos dados)<br>
              • <strong>📊 A cada 3 dias:</strong> Equilibrio entre performance e manutenção<br>
              • <strong>📈 Semanal:</strong> Uma vez por semana (recomendado)<br>
              • <strong>📋 Quinzenal:</strong> A cada 15 dias<br>
              • <strong>📆 Mensal:</strong> Uma vez por mês
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Definir Período de Retenção</div>
            <div class="step-description">
              Escolha quantos dados manter:<br>
              • <strong>7-15 dias:</strong> Para testes e sistemas temporários<br>
              • <strong>30 dias:</strong> Para análises mensais (recomendado)<br>
              • <strong>60-90 dias:</strong> Para análises trimestrais<br>
              • <strong>1 ano:</strong> Para análises anuais e compliance
            </div>
          </li>
        </ol>

        <div class="highlight-box warning">
          <div class="highlight-box-title">
            <span class="highlight-box-icon">⚠️</span>
            Sobre a Limpeza Automática
          </div>
          <p>A limpeza remove permanentemente dados antigos. Configure períodos adequados às suas necessidades de análise histórica. Faça backups antes de configurar limpezas agressivas.</p>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">🔧 Limpeza Manual</h3>
        <p>Execute limpezas pontuais quando necessário:</p>
        
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Avaliar Necessidade</div>
            <div class="step-description">
              Execute limpeza manual se:<br>
              • O banco está muito lento<br>
              • Há problemas de espaço em disco<br>
              • Dados antigos não são mais relevantes
            </div>
          </li>
          <li class="step-item">
            <div class="step-title">Fazer Backup Preventivo</div>
            <div class="step-description">SEMPRE faça backup antes de limpezas manuais</div>
          </li>
          <li class="step-item">
            <div class="step-title">Executar Limpeza</div>
            <div class="step-description">
              1. Clique em "🧹 Executar Limpeza Agora"<br>
              2. Confirme a operação<br>
              3. Aguarde o relatório de registros removidos
            </div>
          </li>
        </ol>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📊 Monitoramento de Status</h3>
        <p>A barra de status na parte superior mostra 4 indicadores importantes:</p>
        
        <div class="especificacoes-tabela">
          <table>
            <thead>
              <tr>
                <th>Indicador</th>
                <th>Status Saudável</th>
                <th>Status Problemático</th>
                <th>Ação Necessária</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>🗄️ Banco</strong></td>
                <td>🟢 Conectado</td>
                <td>🔴 Desconectado</td>
                <td>Verificar IP, porta e servidor Python</td>
              </tr>
              <tr>
                <td><strong>💾 Backup</strong></td>
                <td>✅ Ativo</td>
                <td>💾 Inativo</td>
                <td>Configurar backup automático</td>
              </tr>
              <tr>
                <td><strong>🧹 Limpeza</strong></td>
                <td>🧹 Ativa</td>
                <td>🧹 Inativa</td>
                <td>Configurar limpeza automática</td>
              </tr>
              <tr>
                <td><strong>🔄 Scheduler</strong></td>
                <td>🟢 Ativo</td>
                <td>🔴 Parado</td>
                <td>Reiniciar servidor Python</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">💡</span>
          Boas Práticas para o Banco de Dados
        </div>
        <ul>
          <li><strong>Backup Regular:</strong> Configure backup semanal automático</li>
          <li><strong>Monitoramento:</strong> Verifique status semanalmente</li>
          <li><strong>Limpeza Planejada:</strong> Configure retenção adequada às necessidades</li>
          <li><strong>Manutenção Preventiva:</strong> Teste restauração de backups periodicamente</li>
          <li><strong>Documentação:</strong> Anote mudanças importantes de configuração</li>
          <li><strong>Acesso Controlado:</strong> Apenas administradores devem alterar configurações</li>
        </ul>
      </div>

      <div class="highlight-box danger">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">🚨</span>
          Situações de Emergência
        </div>
        <p><strong>Se todos os dados forem perdidos:</strong></p>
        <ol>
          <li>NÃO entre em pânico - o sistema de iluminação continua funcionando</li>
          <li>Pare imediatamente qualquer operação de limpeza ou restauração</li>
          <li>Contate o suporte técnico imediatamente</li>
          <li>Se houver backup recente, aguarde orientação para restauração</li>
          <li>O sistema começará a coletar novos dados automaticamente</li>
        </ol>
      </div>
    </section>

    <!-- Seção 9: Esquemas de Ligação Elétrica -->
    <section class="manual-section" id="esquema-ligacao">
      <h2 class="section-title">
        <span class="section-icon">⚡</span>
        Esquemas de Ligação Elétrica
      </h2>
      
      <p>O Sistema de Iluminação Viza é composto por dois tipos de ESP32 que trabalham em conjunto: um <strong>MESTRE</strong> (interface e controle) e um <strong>ESCRAVO</strong> (sensores e luminárias).</p>

      <div class="tab-container">
        <div class="tab-buttons">
          <div class="tab-button active" onclick="showTab('mestre')">📱 ESP32 MESTRE</div>
          <div class="tab-button" onclick="showTab('escravo')">🌞 ESP32 ESCRAVO</div>
          <div class="tab-button" onclick="showTab('comunicacao')">📡 Comunicação</div>
        </div>

        <!-- TAB: ESP32 MESTRE -->
        <div id="tab-mestre" class="tab-content active">
          <div class="sistema-title">
            <span style="font-size: 1.5em;">📱</span>
            ESP32 MESTRE - Interface e Controle
          </div>

          <div class="pin-diagram">
            <div class="pin-esp32">ESP32 MESTRE - Pinagem Utilizada</div>
            
            <div class="pin-connection">
              <span class="pin-left">VIN</span>
              <span>←→</span>
              <span class="pin-right">Fonte 5V (+) + RTC VCC</span>
            </div>
            
            <div class="pin-connection">
              <span class="pin-left">GND</span>
              <span>←→</span>
              <span class="pin-right">Fonte 5V (-) + RTC GND</span>
            </div>
            
            <div class="pin-connection">
              <span class="pin-left">GPIO25</span>
              <span>←→</span>
              <span class="pin-right">RTC SDA (Serial Data)</span>
            </div>
            
            <div class="pin-connection">
              <span class="pin-left">GPIO26</span>
              <span>←→</span>
              <span class="pin-right">RTC SCL (Serial Clock)</span>
            </div>
          </div>

          <div class="componentes-grid">
            <div class="componente-item">
              <div class="componente-icon">📱</div>
              <div class="componente-info">
                <h4>ESP32 MESTRE</h4>
                <p><strong>Funções:</strong> Interface web, agendamentos, comunicação com escravo via WiFi/ESP-NOW. Gerencia toda a lógica do sistema.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">🕒</div>
              <div class="componente-info">
                <h4>Módulo RTC DS3231</h4>
                <p><strong>Comunicação I2C:</strong> Mantém horário preciso com backup de bateria. Endereço 0x68, precisão ±2ppm.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">⚡</div>
              <div class="componente-info">
                <h4>Fonte 5V (Mestre)</h4>
                <p><strong>Alimentação:</strong> 220V AC → 5V DC para ESP32 e RTC. Isolada e estabilizada.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">🔋</div>
              <div class="componente-info">
                <h4>Bateria Backup CR2032</h4>
                <p><strong>Backup:</strong> Mantém RTC funcionando mesmo sem energia elétrica. Duração: 10+ anos.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: ESP32 ESCRAVO -->
        <div id="tab-escravo" class="tab-content">
          <div class="sistema-title">
            <span style="font-size: 1.5em;">🌞</span>
            ESP32 ESCRAVO - Sensores e Controle das Luminárias
          </div>

          <div class="pin-diagram">
            <div class="pin-esp32">ESP32 ESCRAVO - Pinagem Utilizada</div>
            
            <div class="pin-connection">
              <span class="pin-left">VIN</span>
              <span>←→</span>
              <span class="pin-right">Fonte 5V (+) + LDR Terminal 1</span>
            </div>
            
            <div class="pin-connection">
              <span class="pin-left">GND</span>
              <span>←→</span>
              <span class="pin-right">Fonte 5V (-) + Resistor 220Ω + Luminárias (-)</span>
            </div>
            
            <div class="pin-connection">
              <span class="pin-left">GPIO35</span>
              <span>←→</span>
              <span class="pin-right">LDR Terminal 2 + Resistor 220Ω</span>
            </div>
            
            <div class="pin-connection">
              <span class="pin-left">GPIO25</span>
              <span>←→</span>
              <span class="pin-right">TODAS as Luminárias (+) - 480 unidades</span>
            </div>
          </div>

          <div class="componentes-grid">
            <div class="componente-item">
              <div class="componente-icon">🌞</div>
              <div class="componente-info">
                <h4>Sensor LDR + Resistor 220Ω</h4>
                <p><strong>Divisor de tensão:</strong> Detecta luz ambiente automaticamente. LDR varia de 1kΩ (dia) a 10kΩ (noite).</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">💡</div>
              <div class="componente-info">
                <h4>480 Luminárias LED</h4>
                <p><strong>Controle unificado:</strong> Todas controladas simultaneamente via GPIO25 (PWM). Estacionamento: 225x50W, Loja: 241x30W, Depósito: 14x40W.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">📱</div>
              <div class="componente-info">
                <h4>ESP32 ESCRAVO</h4>
                <p><strong>Funções:</strong> Leitura do sensor LDR, controle PWM das luminárias, monitoramento de consumo, comunicação com mestre.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">⚡</div>
              <div class="componente-info">
                <h4>Fonte 5V (Escravo)</h4>
                <p><strong>Alimentação:</strong> 220V AC → 5V DC apenas para ESP32. Luminárias alimentadas direto da rede 220V.</p>
              </div>
            </div>
          </div>

          <div class="highlight-box info">
            <div class="highlight-box-title">
              <span class="highlight-box-icon">💡</span>
              Funcionamento do Circuito LDR
            </div>
            <p><strong>Divisor de tensão:</strong> O LDR e resistor 220Ω formam um divisor que varia a tensão no GPIO35 conforme a luz:</p>
            <ul>
              <li><strong>Dia (muita luz):</strong> LDR ≈ 1kΩ → GPIO35 lê ~0.9V (valor alto)</li>
              <li><strong>Noite (pouca luz):</strong> LDR ≈ 10kΩ → GPIO35 lê ~0.1V (valor baixo)</li>
              <li><strong>Resolução:</strong> 12 bits (0-4095) para detecção precisa</li>
            </ul>
          </div>
        </div>

        <!-- TAB: COMUNICAÇÃO -->
        <div id="tab-comunicacao" class="tab-content">
          <div class="sistema-title">
            <span style="font-size: 1.5em;">📡</span>
            Comunicação entre MESTRE e ESCRAVO
          </div>

          <div class="componentes-grid">
            <div class="componente-item">
              <div class="componente-icon">🌐</div>
              <div class="componente-info">
                <h4>WiFi/ESP-NOW</h4>
                <p><strong>Protocolo:</strong> Comunicação wireless direta entre os ESP32. Baixa latência e alta confiabilidade.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">📤</div>
              <div class="componente-info">
                <h4>Comandos (Mestre → Escravo)</h4>
                <p><strong>Controle:</strong> Liga/desliga, ajuste de brilho, modo automático/manual, solicitação de status.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">📥</div>
              <div class="componente-info">
                <h4>Feedback (Escravo → Mestre)</h4>
                <p><strong>Monitoramento:</strong> Status das luminárias, consumo energético, leitura do sensor LDR, confirmações.</p>
              </div>
            </div>
            
            <div class="componente-item">
              <div class="componente-icon">🔄</div>
              <div class="componente-info">
                <h4>Sincronização</h4>
                <p><strong>Tempo:</strong> Mestre sincroniza horário com escravo via RTC para agendamentos precisos.</p>
              </div>
            </div>
          </div>

          <h4>🔄 Fluxo de Funcionamento:</h4>
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0;">
            <ol>
              <li><strong>Usuário:</strong> Acessa interface web no ESP32 Mestre</li>
              <li><strong>Processamento:</strong> Mestre consulta RTC e processa comando</li>
              <li><strong>Transmissão:</strong> Comando enviado via WiFi/ESP-NOW para Escravo</li>
              <li><strong>Execução:</strong> Escravo controla luminárias e sensores</li>
              <li><strong>Resposta:</strong> Escravo envia status de volta para Mestre</li>
              <li><strong>Interface:</strong> Dados atualizados na interface web</li>
            </ol>
          </div>
        </div>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📋 Especificações Técnicas Gerais</h3>
        <div class="especificacoes-tabela">
          <table>
            <thead>
              <tr>
                <th>Sistema</th>
                <th>Componente</th>
                <th>Especificação</th>
                <th>Função</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td rowspan="3"><strong>MESTRE</strong></td>
                <td>ESP32</td>
                <td>240MHz, WiFi, Servidor Web</td>
                <td>Interface e comunicação</td>
              </tr>
              <tr>
                <td>RTC DS3231</td>
                <td>I2C, ±2ppm, backup CR2032</td>
                <td>Controle de tempo</td>
              </tr>
              <tr>
                <td>Fonte 5V</td>
                <td>220V→5V, 3A</td>
                <td>Alimentação Mestre + RTC</td>
              </tr>
              <tr>
                <td rowspan="4"><strong>ESCRAVO</strong></td>
                <td>ESP32</td>
                <td>240MHz, PWM, ADC 12-bit</td>
                <td>Controle luminárias + sensores</td>
              </tr>
              <tr>
                <td>Sensor LDR</td>
                <td>1kΩ-10kΩ, fotoresistor</td>
                <td>Detecção luz ambiente</td>
              </tr>
              <tr>
                <td>480 Luminárias LED</td>
                <td>88.50W, 220V AC</td>
                <td>Iluminação dos setores</td>
              </tr>
              <tr>
                <td>Fonte 5V</td>
                <td>220V→5V, 3A</td>
                <td>Alimentação Escravo</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="highlight-box warning">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">⚠️</span>
          Segurança na Instalação
        </div>
        <p><strong>IMPORTANTE:</strong> Sempre desligue a alimentação 220V antes de fazer qualquer conexão. Use EPIs adequados e siga as normas NR-10.</p>
        <ul>
          <li>✅ Verificar tensões com multímetro</li>
          <li>✅ Testar continuidade antes de energizar</li>
          <li>✅ Instalar proteções (disjuntores, fusíveis)</li>
          <li>✅ Isolar adequadamente todas as conexões</li>
          <li>✅ Documentar todas as modificações</li>
        </ul>
      </div>
    </section>

    <!-- Seção 10: Solução de Problemas -->
    <section class="manual-section" id="troubleshooting">
      <h2 class="section-title">
        <span class="section-icon">🔧</span>
        Solução de Problemas
      </h2>
      
      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">🔴</div>
        <div class="troubleshoot-content">
          <h4>Sistema Mostra "Offline" no Canto Superior</h4>
          <p><strong>Solução:</strong> Verifique sua conexão com a internet. Recarregue a página (F5). Se persistir, verifique se o equipamento do sistema está ligado e conectado à rede.</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">⚠️</div>
        <div class="troubleshoot-content">
          <h4>Luminárias Não Respondem aos Comandos</h4>
          <p><strong>Solução:</strong> Verifique se o setor está em "Modo Manual". Se estiver em "Modo Automático", os comandos manuais não funcionam. Mude para "Modo Manual" primeiro.</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">🟡</div>
        <div class="troubleshoot-content">
          <h4>Muitas Luminárias em "Sem Comunicação"</h4>
          <p><strong>Solução:</strong> Pode ser problema temporário de rede. Aguarde alguns minutos. Se persistir, anote quais setores estão afetados e contate o suporte técnico.</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">⏰</div>
        <div class="troubleshoot-content">
          <h4>Agendamentos Não Funcionam</h4>
          <p><strong>Solução:</strong> 1) Verifique se o setor está em "Modo Automático". 2) Sincronize o relógio do sistema. 3) Confirme se o agendamento está marcado como "ATIVO".</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">📊</div>
        <div class="troubleshoot-content">
          <h4>Tabela de Consumo Vazia ou "Nenhum Registro Encontrado"</h4>
          <p><strong>Solução:</strong> Sistema novo demora 1 hora para primeira coleta. Se sistema já antigo: 1) Clique "🔄 Atualizar Dados". 2) Verifique status de conexão. 3) Aguarde próxima coleta automática (horário cheio).</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">🔄</div>
        <div class="troubleshoot-content">
          <h4>Muitos Registros Aparecem como "Recuperado"</h4>
          <p><strong>Solução:</strong> Indica problemas de comunicação intermitentes. Verifique estabilidade da rede, cabo de internet e alimentação do ESP32. Se persistir, contate suporte técnico.</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">⚡</div>
        <div class="troubleshoot-content">
          <h4>Eficiência Energética Muito Baixa (abaixo de 50%)</h4>
          <p><strong>Solução:</strong> Pode indicar: 1) Luminárias defeituosas. 2) Problemas na rede elétrica. 3) Configuração incorreta. Anote os horários afetados e contate manutenção técnica.</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">🔌</div>
        <div class="troubleshoot-content">
          <h4>Falha na Comunicação ESP32 Mestre ↔ Escravo</h4>
          <p><strong>Solução:</strong> 1) Verifique alimentação de ambos os ESP32. 2) Confirme se estão na mesma rede WiFi. 3) Reinicie ambos os dispositivos. 4) Verifique se não há interferência de outros equipamentos 2.4GHz.</p>
        </div>
      </div>

      <div class="troubleshoot-item">
        <div class="troubleshoot-icon">🌞</div>
        <div class="troubleshoot-content">
          <h4>Sensor LDR Não Detecta Mudanças de Luz</h4>
          <p><strong>Solução:</strong> 1) Limpe o sensor LDR. 2) Verifique conexões GPIO35 e resistor 220Ω. 3) Teste cobrindo/descobrindo o sensor. 4) Substitua LDR ou resistor se necessário.</p>
        </div>
      </div>
    </section>

    <!-- Seção 11: FAQ -->
    <section class="manual-section" id="faq">
      <h2 class="section-title">
        <span class="section-icon">❓</span>
        Perguntas Frequentes
      </h2>
      
      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Posso usar o sistema no meu celular?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Sim! O sistema funciona perfeitamente em celulares, tablets e computadores. Basta acessar pelo navegador. Você pode até instalar como um aplicativo clicando no botão de instalação que aparece no canto inferior direito.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          O que acontece se eu fechar o navegador?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Nada! O sistema continua funcionando normalmente no servidor. Fechar o navegador só fecha a sua visualização. Os agendamentos e configurações permanecem ativos.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Várias pessoas podem usar o sistema ao mesmo tempo?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Sim! Múltiplas pessoas podem acessar simultaneamente. Porém, tenha cuidado com alterações conflitantes. É recomendado que apenas uma pessoa faça alterações por vez.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Como sei se minhas alterações foram aplicadas?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>O sistema sempre mostra notificações (toasts) no canto superior direito confirmando as ações. Mensagens verdes indicam sucesso, vermelhas indicam erro.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          O sistema funciona se faltar energia elétrica?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Se faltar energia, as luminárias obviamente apagam. Quando a energia retorna, o sistema reinicia automaticamente e volta a funcionar com as últimas configurações salvas.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Posso criar agendamentos diferentes para cada dia da semana?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Atualmente o sistema funciona com agendamentos diários (mesmo horário todos os dias). Para horários específicos de cada dia, você precisará ajustar manualmente conforme necessário.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          O que são "dados reais" e como diferem de estimativas?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Dados reais são medições diretas coletadas pelo ESP32 a cada hora. Diferente de estimativas ou simulações, estes representam o consumo efetivo registrado pelo hardware. Você verá apenas horários onde há registros válidos do sistema.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Por que alguns registros aparecem como "Recuperado"?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Quando há falhas temporárias (falta de energia, problemas de rede), o sistema detecta lacunas nos dados e as preenche automaticamente com base nos valores atuais. Estes aparecem marcados como "🔄 Recuperado" para transparência total.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Com que frequência os dados de consumo são coletados?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>O ESP32 coleta dados automaticamente a cada hora cheia (ex: 14:00, 15:00, 16:00). A tela é atualizada automaticamente a cada minuto, mas novos registros só aparecem após cada coleta horária do hardware.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Posso recuperar dados após usar "Resetar Histórico"?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>Não! O reset é permanente e irreversível. Todos os dados históricos são apagados definitivamente. Use esta função apenas quando realmente necessário reiniciar a coleta do zero. Recomendamos fazer backup via "Exportar Excel" antes.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          O que significa "eficiência energética" na tela de consumo?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>É uma métrica que indica quão bem o sistema está sendo utilizado. Valores altos (acima de 80%) indicam uso eficiente. Valores baixos podem indicar desperdício ou problemas técnicos.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Por que o sistema usa dois ESP32 ao invés de um?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>A arquitetura distribuída oferece maior confiabilidade, melhor performance e facilita manutenção. O ESP32 Mestre cuida da interface web e agendamentos, enquanto o Escravo controla as luminárias e sensores. Se um falhar, o outro continua funcionando.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Como o sensor LDR funciona para detectar luz ambiente?
          <span class="faq-icon">▼</span>
        </button>
        <div class="faq-answer">
          <p>O LDR é um fotoresistor que muda sua resistência conforme a luz. Durante o dia (muita luz), sua resistência é baixa (~1kΩ). À noite (pouca luz), aumenta (~10kΩ). Junto com o resistor de 220Ω, forma um divisor de tensão que o ESP32 lê no GPIO35.</p>
        </div>
      </div>
    </section>

    <!-- Seção 12: Contato -->
    <section class="manual-section" id="contato">
      <h2 class="section-title">
        <span class="section-icon">📞</span>
        Suporte Técnico
      </h2>
      
      <div class="subsection">
        <h3 class="subsection-title">🆘 Quando Contatar o Suporte</h3>
        <ul>
          <li>Sistema completamente fora do ar</li>
          <li>Luminárias em "Sem Comunicação" por mais de 30 minutos</li>
          <li>Problemas na comunicação entre ESP32 Mestre e Escravo</li>
          <li>Sensor LDR não funciona corretamente</li>
          <li>Dúvidas sobre configurações avançadas</li>
          <li>Solicitação de novos recursos ou melhorias</li>
        </ul>
      </div>

      <div class="subsection">
        <h3 class="subsection-title">📋 Informações para Fornecer ao Suporte</h3>
        <ol class="step-list">
          <li class="step-item">
            <div class="step-title">Descreva o Problema</div>
            <div class="step-description">Explique detalhadamente o que está acontecendo e quando começou.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Informe os Setores Afetados</div>
            <div class="step-description">Diga se é no estacionamento, loja, depósito ou em todos.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Especifique o ESP32</div>
            <div class="step-description">Informe se o problema é no ESP32 Mestre (interface web) ou Escravo (luminárias/sensores).</div>
          </li>
          <li class="step-item">
            <div class="step-title">Tire Screenshots</div>
            <div class="step-description">Se possível, tire fotos da tela mostrando o problema.</div>
          </li>
          <li class="step-item">
            <div class="step-title">Teste Básico</div>
            <div class="step-description">Tente recarregar a página (F5) e informe se o problema persiste.</div>
          </li>
        </ol>
      </div>

      <div class="highlight-box info">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">📞</span>
          Contatos de Suporte
        </div>       
        <p><strong>Engemase Engenharia</strong><br>
        🌐 Website: www.engemase.com.br<br>
        📧 Email: suporte@engemase.com.br<br>
        📞 Telefone: +55 (49) 3567-2016</p>
      </div>

      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">⏰</span>
          Horário de Atendimento
        </div>
        <p><strong>Suporte Técnico:</strong><br>
        Segunda a Sexta: 7h30 às 17h48<br>
        <strong>Emergências:</strong> 24 horas por dia<br>
        (Apenas para problemas críticos de segurança)</p>
      </div>
    </section>

    <!-- Conclusão -->
    <section class="manual-section">
      <h2 class="section-title">
        <span class="section-icon">🎯</span>
        Conclusão
      </h2>
      
      <div class="highlight-box tip">
        <div class="highlight-box-title">
          <span class="highlight-box-icon">🎓</span>
          Parabéns! Você Está Pronto
        </div>
        <p>Agora você tem todo o conhecimento necessário para operar o Sistema de Iluminação Viza com segurança e eficiência. Lembre-se:</p>
        <ul>
          <li>✅ Sempre verifique o status de conexão antes de fazer alterações</li>
          <li>✅ Use agendamentos para automatizar a operação</li>
          <li>✅ Monitore o consumo regularmente para otimizar custos</li>
          <li>✅ Compreenda a arquitetura dual ESP32 para melhor troubleshooting</li>
          <li>✅ Mantenha este manual sempre à disposição</li>
          <li>✅ Não hesite em contatar o suporte quando necessário</li>
        </ul>
      </div>

      <div class="demo-container">
        <div class="demo-title">🚀 Teste Seus Conhecimentos</div>
        <p style="margin-bottom: 20px;">Agora que você leu o manual, que tal testar o sistema? Sugerimos começar com estas ações seguras:</p>
        <div style="text-align: left; max-width: 600px; margin: 0 auto;">
          <p><strong>1. 👀 Visualização:</strong> Vá na tela de Visualização e observe o status atual das luminárias</p>
          <p><strong>2. ⏰ Horário:</strong> Na tela de Controle, sincronize o relógio do sistema</p>
          <p><strong>3. 📊 Consumo:</strong> Configure a tarifa de energia na tela de Consumo</p>
          <p><strong>4. 🧪 Teste Manual:</strong> Mude um setor para Modo Manual, ajuste o brilho e volte para Automático</p>
          <p><strong>5. 🔌 Verifique Conexões:</strong> Consulte os esquemas de ligação para entender melhor o sistema</p>
        </div>
      </div>
    </section>
  </div>

  <!-- Menu Inferior Estilo App -->
  <nav class="bottom-nav">
    <div class="nav-container">
      <a href="/" class="nav-item">
        <div class="nav-icon">🏢</div>
        <div class="nav-label">Operação</div>
      </a>
      <a href="/Visualizacao" class="nav-item">
        <div class="nav-icon">📊</div>
        <div class="nav-label">Visualização</div>
      </a>
      <a href="/Consumo" class="nav-item">
        <div class="nav-icon">⚡</div>
        <div class="nav-label">Consumo</div>
      </a>
      <a href="/Banco" class="nav-item">
        <div class="nav-icon">🗄️</div>
        <div class="nav-label">Banco</div>
      </a>
      <a href="/Manual" class="nav-item active">
        <div class="nav-icon">📖</div>
        <div class="nav-label">Manual</div>
      </a>
    </div>
  </nav>

  <!-- Botão de download PDF -->
  <button class="download-pdf-btn" id="downloadPdfBtn" onclick="gerarPDF()">
    <span class="download-pdf-icon">📄</span>
    <span class="download-pdf-text">Download PDF</span>
  </button>

  <!-- Modal de progresso do PDF -->
  <div class="pdf-progress-modal" id="pdfProgressModal">
    <div class="pdf-progress-content">
      <div class="pdf-progress-title">📄 Gerando Manual em PDF</div>
      <div class="pdf-progress-bar-container">
        <div class="pdf-progress-bar" id="pdfProgressBar"></div>
      </div>
      <div class="pdf-progress-text" id="pdfProgressText">Preparando documento...</div>
    </div>
  </div>

  <script>
    // ========== SISTEMA DE NOTIFICAÇÕES TOAST ==========
    
    // Classe Das Notificações
    class ToastManager {
      constructor() {
        this.container = document.getElementById('toast-container');
        this.toasts = new Map();
        this.nextId = 1;
      }

      isDuplicate(title, message) {
        for (let [id, toastData] of this.toasts) {
          const existingTitle = toastData.element.querySelector('.toast-title')?.textContent;
          const existingMessage = toastData.element.querySelector('.toast-message')?.textContent || '';
          
          if (existingTitle === title && existingMessage === message) {
            return id;
          }
        }
        return null;
      }

      show(type = 'info', title, message, options = {}) {
        // ANTI-DUPLICATA: Verificar se já existe toast similar
        const duplicateId = this.isDuplicate(title, message);
        if (duplicateId) {
          // Se encontrou duplicata, apenas resetar o timer do existente
          const existingToast = this.toasts.get(duplicateId);
          if (existingToast && !existingToast.config.persistent) {
            this.scheduleRemoval(duplicateId, options.duration || existingToast.config.duration);
          }
          return duplicateId;
        }

        // LIMITE MÁXIMO: Remover toasts antigos se exceder limite
        if (this.toasts.size >= 3) {
          const oldestId = this.toasts.keys().next().value;
          this.remove(oldestId);
        }
        
        const id = this.nextId++;
        
        const config = {
          duration: options.duration || (type === 'error' ? 6000 : 4000),
          persistent: options.persistent || false,
          closable: options.closable !== false,
          action: options.action || null,
          ...options
        };

        const toast = this.createToast(id, type, title, message, config);
        this.container.appendChild(toast);
        this.toasts.set(id, { element: toast, config });

        // Mostrar com animação
        requestAnimationFrame(() => {
          toast.classList.add('show');
        });

        // Auto-dismiss se não for persistente
        if (!config.persistent) {
          this.scheduleRemoval(id, config.duration);
        }

        return id;
      }

      createToast(id, type, title, message, config) {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'polite');

        const icons = {
          success: '✅',
          error: '❌', 
          warning: '⚠️',
          info: 'ℹ️',
          system: '⚙️'
        };

        toast.innerHTML = `
          <div class="toast-icon">${icons[type] || 'ℹ️'}</div>
          <div class="toast-content">
            <div class="toast-title">${title}</div>
            ${message ? `<div class="toast-message">${message}</div>` : ''}
          </div>
          ${config.closable ? '<button class="toast-close" aria-label="Fechar">×</button>' : ''}
          ${!config.persistent ? '<div class="toast-progress"></div>' : ''}
        `;

        if (config.closable) {
          const closeBtn = toast.querySelector('.toast-close');
          closeBtn.addEventListener('click', () => this.remove(id));
        }

        if (config.action) {
          const actionBtn = document.createElement('button');
          actionBtn.textContent = config.action.text;
          actionBtn.className = 'toast-action';
          actionBtn.addEventListener('click', config.action.callback);
          toast.querySelector('.toast-content').appendChild(actionBtn);
        }

        if (!config.persistent) {
          const progress = toast.querySelector('.toast-progress');
          if (progress) {
            progress.style.width = '100%';
            progress.style.transition = `width ${config.duration}ms linear`;
            requestAnimationFrame(() => {
              progress.style.width = '0%';
            });
          }
        }

        return toast;
      }

      scheduleRemoval(id, delay) {
        setTimeout(() => {
          this.remove(id);
        }, delay);
      }

      remove(id) {
        const toastData = this.toasts.get(id);
        if (!toastData) return;

        const { element } = toastData;
        element.classList.add('hide');

        setTimeout(() => {
          if (element.parentNode) {
            element.parentNode.removeChild(element);
          }
          this.toasts.delete(id);
        }, 400);
      }

      success(title, message, options) {
        return this.show('success', title, message, options);
      }

      error(title, message, options) {
        return this.show('error', title, message, { persistent: true, ...options });
      }

      warning(title, message, options) {
        return this.show('warning', title, message, options);
      }

      info(title, message, options) {
        return this.show('info', title, message, options);
      }

      system(title, message, options) {
        return this.show('system', title, message, options);
      }
    }

    // Instância global do toast
    const toast = new ToastManager();

    // ========== CONTROLE DE TABS DOS ESQUEMAS ==========
    
    function showTab(tabName) {
      // Esconder todas as tabs
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Remover classe active de todos os botões
      document.querySelectorAll('.tab-button').forEach(button => {
        button.classList.remove('active');
      });
      
      // Mostrar tab selecionada
      document.getElementById('tab-' + tabName).classList.add('active');
      
      // Ativar botão correspondente
      event.target.classList.add('active');
    }

    // ========== FUNÇÕES DE BUSCA NO MANUAL ==========
    
    // Variáveis globais para navegação de busca
    let resultadosBusca = [];
    let indiceAtual = 0;
    
    function limparPesquisa() {
      const searchInput = document.getElementById('searchInput');
      const searchResultsInfo = document.getElementById('searchResultsInfo');
      const searchClear = document.getElementById('searchClear');
      const searchNavigation = document.getElementById('searchNavigation');
      
      if (searchInput) searchInput.value = '';
      if (searchResultsInfo) searchResultsInfo.classList.remove('visible');
      if (searchClear) searchClear.classList.remove('visible');
      if (searchNavigation) searchNavigation.style.display = 'none';
      
      // Resetar variáveis de navegação
      resultadosBusca = [];
      indiceAtual = 0;
      
      // Remover todos os destaques
      document.querySelectorAll('.search-highlight').forEach(el => {
        const parent = el.parentNode;
        if (parent) {
          parent.replaceChild(document.createTextNode(el.textContent), el);
          parent.normalize();
        }
      });
    }

    function realizarBusca(termo) {
      limparPesquisa();
      
      if (!termo || termo.length < 2) {
        toast.warning('Busca Inválida', 'Digite pelo menos 2 caracteres');
        return;
      }
      
      const searchClear = document.getElementById('searchClear');
      const searchResultsInfo = document.getElementById('searchResultsInfo');
      const searchResultsText = document.getElementById('searchResultsText');
      const searchNavigation = document.getElementById('searchNavigation');
      
      if (searchClear) searchClear.classList.add('visible');
      
      const regex = new RegExp(`(${termo.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      resultadosBusca = []; // Limpar array de resultados
      
      // Buscar em todas as seções
      const sections = document.querySelectorAll('.manual-section, .subsection, .highlight-box, .step-item, .faq-item');
      
      sections.forEach(section => {
        const walker = document.createTreeWalker(
          section,
          NodeFilter.SHOW_TEXT,
          {
            acceptNode: function(node) {
              if (node.parentElement.tagName === 'SCRIPT' || 
                  node.parentElement.tagName === 'STYLE' ||
                  node.parentElement.classList.contains('search-container')) {
                return NodeFilter.FILTER_REJECT;
              }
              return NodeFilter.FILTER_ACCEPT;
            }
          }
        );
        
        const nodesToReplace = [];
        let node;
        while (node = walker.nextNode()) {
          if (regex.test(node.textContent)) {
            nodesToReplace.push(node);
          }
        }
        
        nodesToReplace.forEach(node => {
          const span = document.createElement('span');
          span.innerHTML = node.textContent.replace(regex, '<span class="search-highlight">$1</span>');
          node.parentElement.replaceChild(span, node);
          
          // Adicionar todos os highlights ao array de resultados
          const highlights = span.querySelectorAll('.search-highlight');
          highlights.forEach(highlight => {
            resultadosBusca.push(highlight);
          });
        });
      });
      
      // Mostrar resultados
      if (searchResultsInfo && searchResultsText) {
        if (resultadosBusca.length > 0) {
          searchResultsText.innerHTML = `✅ Encontrados <strong>${resultadosBusca.length}</strong> resultado(s) para "<strong>${termo}</strong>"`;
          searchResultsInfo.classList.add('visible');
          
          // Mostrar navegação se houver mais de 1 resultado
          if (resultadosBusca.length > 1 && searchNavigation) {
            searchNavigation.style.display = 'flex';
          }
          
          // Ir para o primeiro resultado
          indiceAtual = 0;
          atualizarResultadoAtivo();
          
          toast.success('Busca Concluída', `${resultadosBusca.length} resultado(s) encontrado(s)`, {
            duration: 3000
          });
        } else {
          searchResultsText.innerHTML = `❌ Nenhum resultado encontrado para "<strong>${termo}</strong>"`;
          searchResultsInfo.classList.add('visible');
          toast.warning('Sem Resultados', 'Tente usar termos diferentes');
        }
      }
    }
    
    function atualizarResultadoAtivo() {
      if (resultadosBusca.length === 0) return;
      
      // Remover classe active de todos
      resultadosBusca.forEach(el => el.classList.remove('active'));
      
      // Adicionar classe active ao atual
      const elementoAtivo = resultadosBusca[indiceAtual];
      if (elementoAtivo) {
        elementoAtivo.classList.add('active');
        
        // Scroll suave para o elemento
        elementoAtivo.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center',
          inline: 'nearest'
        });
        
        // Atualizar contador
        const searchCounter = document.getElementById('searchCounter');
        if (searchCounter) {
          searchCounter.textContent = `${indiceAtual + 1}/${resultadosBusca.length}`;
        }
        
        // Atualizar estado dos botões
        const prevBtn = document.getElementById('searchPrevBtn');
        const nextBtn = document.getElementById('searchNextBtn');
        
        if (prevBtn) {
          prevBtn.disabled = (indiceAtual === 0);
        }
        if (nextBtn) {
          nextBtn.disabled = (indiceAtual === resultadosBusca.length - 1);
        }
      }
    }
    
    function navegarProximoResultado() {
      if (indiceAtual < resultadosBusca.length - 1) {
        indiceAtual++;
        atualizarResultadoAtivo();
      }
    }
    
    function navegarResultadoAnterior() {
      if (indiceAtual > 0) {
        indiceAtual--;
        atualizarResultadoAtivo();
      }
    }

    // Função para voltar ao topo
    function voltarAoTopo() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    // ========== GERAÇÃO DE PDF ==========

    async function gerarPDF() {
      const btn = document.getElementById('downloadPdfBtn');
      const modal = document.getElementById('pdfProgressModal');
      const progressBar = document.getElementById('pdfProgressBar');
      const progressText = document.getElementById('pdfProgressText');
      
      // Verificar se as bibliotecas estão carregadas
      if (typeof window.jsPDF === 'undefined' || typeof html2canvas === 'undefined') {
        toast.error('Erro no Download', 'Bibliotecas PDF não carregadas. Tente recarregar a página.');
        return;
      }
      
      // Preparar interface
      btn.disabled = true;
      btn.innerHTML = '<span class="pdf-loading"></span><span class="download-pdf-text">Gerando...</span>';
      modal.style.display = 'flex';
      
      try {
        // Atualizar progresso
        atualizarProgressoPDF(10, 'Preparando conteúdo...');
        
        // Criar uma versão limpa do conteúdo para PDF
        const conteudoOriginal = document.querySelector('.container');
        const conteudoPDF = conteudoOriginal.cloneNode(true);
        
        // Remover elementos que não devem aparecer no PDF
        const elementosRemover = [
          '.demo-container',
          '.toast-container',
          '.pdf-progress-modal'
        ];
        
        elementosRemover.forEach(seletor => {
          conteudoPDF.querySelectorAll(seletor).forEach(el => el.remove());
        });
        
        // Expandir todas as FAQs no clone
        conteudoPDF.querySelectorAll('.faq-question').forEach(q => {
          q.classList.add('active');
          const answer = q.nextElementSibling;
          if (answer) {
            answer.classList.add('active');
            answer.style.display = 'block';
            answer.style.maxHeight = 'none';
            answer.style.padding = '15px 20px';
          }
        });
        
        // Expandir todas as tabs no clone
        conteudoPDF.querySelectorAll('.tab-content').forEach(tab => {
          tab.classList.add('active');
          tab.style.display = 'block';
        });
        
        // Criar wrapper para o conteúdo
        const wrapperPDF = document.createElement('div');
        wrapperPDF.style.background = 'white';
        wrapperPDF.style.fontFamily = 'Arial, sans-serif';
        wrapperPDF.style.fontSize = '11px';
        wrapperPDF.style.lineHeight = '1.4';
        wrapperPDF.style.color = '#333';
        wrapperPDF.style.padding = '0';
        wrapperPDF.style.margin = '0';
        
        // Ajustar estilos do conteúdo para PDF (versão compacta)
        conteudoPDF.style.padding = '8mm';
        conteudoPDF.style.maxWidth = 'none';
        conteudoPDF.style.marginLeft = '0';
        
        // Ajustar título principal
        const mainTitle = conteudoPDF.querySelector('.main-title');
        if (mainTitle) {
          mainTitle.style.marginBottom = '8px';
          mainTitle.style.textAlign = 'center';
          const h1 = mainTitle.querySelector('h1');
          if (h1) {
            h1.style.fontSize = '18px';
            h1.style.marginBottom = '4px';
            h1.style.color = '#2c3e50';
          }
          const p = mainTitle.querySelector('p');
          if (p) {
            p.style.fontSize = '10px';
            p.style.margin = '0';
          }
        }
        
        // Ajustar seções de forma muito compacta
        conteudoPDF.querySelectorAll('.manual-section').forEach(secao => {
          secao.style.background = 'white';
          secao.style.boxShadow = 'none';
          secao.style.border = '1px solid #ddd';
          secao.style.borderRadius = '4px';
          secao.style.marginBottom = '6px';
          secao.style.padding = '8px';
          secao.style.pageBreakInside = 'avoid';
        });
        
        // Ajustar títulos das seções
        conteudoPDF.querySelectorAll('.section-title').forEach(titulo => {
          titulo.style.fontSize = '12px';
          titulo.style.color = '#2c3e50';
          titulo.style.marginBottom = '6px';
          titulo.style.marginTop = '0';
          titulo.style.lineHeight = '1.2';
          titulo.style.fontWeight = '700';
          
          // Ajustar ícones
          const icon = titulo.querySelector('.section-icon');
          if (icon) {
            icon.style.fontSize = '10px';
            icon.style.padding = '3px';
            icon.style.marginRight = '4px';
          }
        });
        
        // Ajustar subsseções
        conteudoPDF.querySelectorAll('.subsection').forEach(sub => {
          sub.style.margin = '4px 0';
          sub.style.padding = '6px';
          sub.style.background = '#f8f9fa';
          sub.style.borderRadius = '3px';
          sub.style.borderLeft = '2px solid #c33636';
        });
        
        conteudoPDF.querySelectorAll('.subsection-title').forEach(subTitulo => {
          subTitulo.style.fontSize = '10px';
          subTitulo.style.marginBottom = '4px';
          subTitulo.style.marginTop = '0';
          subTitulo.style.fontWeight = '600';
        });
        
        // Ajustar parágrafos
        conteudoPDF.querySelectorAll('p').forEach(p => {
          p.style.fontSize = '9px';
          p.style.lineHeight = '1.3';
          p.style.marginBottom = '4px';
          p.style.marginTop = '0';
        });
        
        // Ajustar listas
        conteudoPDF.querySelectorAll('ul, ol').forEach(lista => {
          lista.style.marginBottom = '4px';
          lista.style.marginTop = '0';
          lista.style.paddingLeft = '12px';
        });
        
        conteudoPDF.querySelectorAll('li').forEach(item => {
          item.style.fontSize = '9px';
          item.style.lineHeight = '1.2';
          item.style.marginBottom = '2px';
        });
        
        // Ajustar caixas de destaque
        conteudoPDF.querySelectorAll('.highlight-box').forEach(box => {
          box.style.padding = '6px';
          box.style.margin = '4px 0';
          box.style.borderRadius = '3px';
          box.style.pageBreakInside = 'avoid';
        });
        
        conteudoPDF.querySelectorAll('.highlight-box-title').forEach(boxTitle => {
          boxTitle.style.fontSize = '9px';
          boxTitle.style.marginBottom = '3px';
          boxTitle.style.fontWeight = '600';
        });
        
        // Ajustar passos numerados
        conteudoPDF.querySelectorAll('.step-list').forEach(stepList => {
          stepList.style.margin = '4px 0';
        });
        
        conteudoPDF.querySelectorAll('.step-item').forEach(step => {
          step.style.marginBottom = '4px';
          step.style.padding = '6px 6px 6px 16px';
          step.style.background = 'white';
          step.style.border = '1px solid #eee';
          step.style.borderRadius = '3px';
          step.style.borderLeft = '3px solid #28a745';
          step.style.position = 'relative';
          step.style.fontSize = '9px';
          step.style.lineHeight = '1.2';
          step.style.pageBreakInside = 'avoid';
        });
        
        conteudoPDF.querySelectorAll('.step-title').forEach(stepTitle => {
          stepTitle.style.fontSize = '9px';
          stepTitle.style.fontWeight = '600';
          stepTitle.style.marginBottom = '2px';
        });
        
        conteudoPDF.querySelectorAll('.step-description').forEach(stepDesc => {
          stepDesc.style.fontSize = '8px';
          stepDesc.style.lineHeight = '1.2';
        });
        
        // Ajustar FAQs
        conteudoPDF.querySelectorAll('.faq-item').forEach(faq => {
          faq.style.marginBottom = '4px';
          faq.style.background = 'white';
          faq.style.border = '1px solid #ddd';
          faq.style.borderRadius = '3px';
          faq.style.pageBreakInside = 'avoid';
        });
        
        conteudoPDF.querySelectorAll('.faq-question').forEach(question => {
          question.style.padding = '6px';
          question.style.fontSize = '9px';
          question.style.fontWeight = '600';
          question.style.background = '#f5f5f5';
          question.style.margin = '0';
          question.style.lineHeight = '1.2';
        });
        
        conteudoPDF.querySelectorAll('.faq-answer').forEach(answer => {
          answer.style.padding = '6px';
          answer.style.fontSize = '8px';
          answer.style.lineHeight = '1.2';
          answer.style.background = 'white';
          answer.style.display = 'block';
          answer.style.maxHeight = 'none';
        });
        
        // Ajustar troubleshooting
        conteudoPDF.querySelectorAll('.troubleshoot-item').forEach(trouble => {
          trouble.style.display = 'block';
          trouble.style.padding = '6px';
          trouble.style.marginBottom = '4px';
          trouble.style.background = 'white';
          trouble.style.border = '1px solid #ddd';
          trouble.style.borderRadius = '3px';
          trouble.style.borderLeft = '3px solid #ef4444';
          trouble.style.pageBreakInside = 'avoid';
        });
        
        conteudoPDF.querySelectorAll('.troubleshoot-content h4').forEach(h4 => {
          h4.style.fontSize = '9px';
          h4.style.fontWeight = '600';
          h4.style.marginBottom = '2px';
          h4.style.marginTop = '0';
        });
        
        conteudoPDF.querySelectorAll('.troubleshoot-content p').forEach(p => {
          p.style.fontSize = '8px';
          p.style.lineHeight = '1.2';
          p.style.margin = '0';
        });
        
        // Remover ícones de troubleshooting para economizar espaço
        conteudoPDF.querySelectorAll('.troubleshoot-icon').forEach(icon => {
          icon.style.display = 'none';
        });
        
        // Ajustar componentes grid
        conteudoPDF.querySelectorAll('.componentes-grid').forEach(grid => {
          grid.style.display = 'block';
          grid.style.margin = '4px 0';
        });
        
        conteudoPDF.querySelectorAll('.componente-item').forEach(item => {
          item.style.display = 'block';
          item.style.marginBottom = '4px';
          item.style.padding = '6px';
          item.style.background = 'white';
          item.style.border = '1px solid #ddd';
          item.style.borderRadius = '3px';
          item.style.pageBreakInside = 'avoid';
        });
        
        conteudoPDF.querySelectorAll('.componente-info h4').forEach(h4 => {
          h4.style.fontSize = '9px';
          h4.style.fontWeight = '600';
          h4.style.marginBottom = '2px';
          h4.style.marginTop = '0';
        });
        
        conteudoPDF.querySelectorAll('.componente-info p').forEach(p => {
          p.style.fontSize = '8px';
          p.style.lineHeight = '1.2';
          p.style.margin = '0';
        });
        
        // Ajustar tabelas
        conteudoPDF.querySelectorAll('.especificacoes-tabela').forEach(tabela => {
          tabela.style.margin = '4px 0';
          tabela.style.fontSize = '8px';
        });
        
        conteudoPDF.querySelectorAll('.especificacoes-tabela th, .especificacoes-tabela td').forEach(cell => {
          cell.style.padding = '4px 6px';
          cell.style.fontSize = '8px';
          cell.style.lineHeight = '1.2';
        });
        
        // Ajustar diagramas de pinagem
        conteudoPDF.querySelectorAll('.pin-diagram').forEach(diagram => {
          diagram.style.margin = '4px 0';
          diagram.style.padding = '6px';
          diagram.style.fontSize = '8px';
          diagram.style.pageBreakInside = 'avoid';
        });
        
        conteudoPDF.querySelectorAll('.pin-esp32').forEach(esp => {
          esp.style.padding = '6px';
          esp.style.fontSize = '9px';
          esp.style.margin = '4px 0';
        });
        
        conteudoPDF.querySelectorAll('.pin-connection').forEach(conn => {
          conn.style.padding = '3px 0';
          conn.style.fontSize = '8px';
        });
        
        // Ajustar espaçamentos gerais
        conteudoPDF.querySelectorAll('h1, h2, h3, h4, h5, h6').forEach(heading => {
          heading.style.marginTop = '0';
          heading.style.marginBottom = '4px';
        });
        
        // Compactar espaços em branco desnecessários
        conteudoPDF.querySelectorAll('*').forEach(el => {
          if (el.style.marginTop && parseInt(el.style.marginTop) > 8) {
            el.style.marginTop = '6px';
          }
          if (el.style.marginBottom && parseInt(el.style.marginBottom) > 8) {
            el.style.marginBottom = '4px';
          }
        });
        
        wrapperPDF.appendChild(conteudoPDF);
        
        // Criar elemento temporário para renderização
        const tempContainer = document.createElement('div');
        tempContainer.style.position = 'absolute';
        tempContainer.style.left = '-9999px';
        tempContainer.style.top = '0';
        tempContainer.style.width = '210mm'; // Largura A4
        tempContainer.appendChild(wrapperPDF);
        document.body.appendChild(tempContainer);
        
        atualizarProgressoPDF(30, 'Renderizando conteúdo...');
        
        // Aguardar um pouco para renderização
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // Configurar html2canvas
        const canvas = await html2canvas(tempContainer, {
          scale: 1.5,
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          width: tempContainer.scrollWidth,
          height: tempContainer.scrollHeight,
          onprogress: function(progress) {
            const progressPercent = 30 + (progress * 40);
            atualizarProgressoPDF(progressPercent, 'Capturando páginas...');
          }
        });
        
        atualizarProgressoPDF(75, 'Criando documento PDF...');
        
        // Configurar jsPDF
        const { jsPDF } = window.jsPDF;
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: 'a4'
        });
        
        // Dimensões da página A4 em mm (versão compacta)
        const pageWidth = 210;
        const pageHeight = 297;
        const margin = 8; // Margens reduzidas
        const contentWidth = pageWidth - (margin * 2);
        const contentHeight = pageHeight - (margin * 2) - 8; // Espaço reduzido para numeração
        
        // Calcular dimensões da imagem
        const imgWidth = contentWidth;
        const imgHeight = (canvas.height * contentWidth) / canvas.width;
        
        // Dividir em múltiplas páginas
        const numPages = Math.ceil(imgHeight / contentHeight);
        
        for (let i = 0; i < numPages; i++) {
          if (i > 0) pdf.addPage();
          
          // Calcular posição Y para esta página
          const yOffset = -(i * contentHeight);
          pdf.addImage(canvas.toDataURL('image/jpeg', 0.85), 'JPEG', margin, margin + yOffset, imgWidth, imgHeight);
          
          // Adicionar numeração de página no rodapé
          pdf.setFontSize(9);
          pdf.setTextColor(100, 100, 100);
          const pageText = `${i + 1} / ${numPages}`;
          const textWidth = pdf.getTextWidth(pageText);
          pdf.text(pageText, (pageWidth - textWidth) / 2, pageHeight - 5);
          
          // Atualizar progresso
          const pageProgress = 75 + ((i + 1) / numPages) * 20;
          atualizarProgressoPDF(pageProgress, `Criando página ${i + 1} de ${numPages}...`);
          
          // Pequena pausa para não travar a interface
          await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        atualizarProgressoPDF(95, 'Finalizando download...');
        
        // Gerar nome do arquivo com data
        const agora = new Date();
        const dataFormatada = agora.toISOString().split('T')[0];
        const nomeArquivo = `Manual_Sistema_Viza_${dataFormatada}.pdf`;
        
        // Fazer download
        pdf.save(nomeArquivo);
        
        atualizarProgressoPDF(100, 'Download concluído!');
        
        // Limpar elemento temporário
        document.body.removeChild(tempContainer);
        
        // Sucesso
        setTimeout(() => {
          modal.style.display = 'none';
          toast.success('PDF Gerado com Sucesso!', `Manual salvo como: ${nomeArquivo}`, {
            duration: 8000
          });
        }, 1000);
        
      } catch (error) {
        console.error('Erro ao gerar PDF:', error);
        modal.style.display = 'none';
        toast.error('Erro ao Gerar PDF', 'Falha na geração do documento. Tente novamente ou use a impressão do navegador (Ctrl+P).', {
          action: {
            text: 'Imprimir',
            callback: () => window.print()
          }
        });
      } finally {
        // Restaurar botão
        btn.disabled = false;
        btn.innerHTML = '<span class="download-pdf-icon">📄</span><span class="download-pdf-text">Download PDF</span>';
      }
    }

    // Função Para Atualizar Progresso De Download Do PDF
    function atualizarProgressoPDF(porcentagem, texto) {
      const progressBar = document.getElementById('pdfProgressBar');
      const progressText = document.getElementById('pdfProgressText');
      
      if (progressBar) {
        progressBar.style.width = porcentagem + '%';
      }
      
      if (progressText) {
        progressText.textContent = texto;
      }
    }

    // Função alternativa usando a impressão do navegador
    function gerarPDFSimples() {
      // Ocultar elementos que não devem aparecer no PDF
      const elementosOcultar = [
        '.floating-index',
        '.download-pdf-btn',
        '.toast-container',
        '.demo-container',
        'header nav'
      ];
      
      // Guardar estados originais
      const estadosOriginais = [];
      
      elementosOcultar.forEach(seletor => {
        document.querySelectorAll(seletor).forEach(el => {
          estadosOriginais.push({
            elemento: el,
            display: el.style.display
          });
          el.style.display = 'none';
        });
      });
      
      // Expandir todas as FAQs
      const faqsExpandidas = [];
      document.querySelectorAll('.faq-question').forEach(q => {
        if (!q.classList.contains('active')) {
          q.classList.add('active');
          faqsExpandidas.push(q);
          const answer = q.nextElementSibling;
          if (answer) {
            answer.classList.add('active');
            faqsExpandidas.push(answer);
          }
        }
      });
      
      // Abrir janela de impressão
      setTimeout(() => {
        window.print();
        
        // Restaurar elementos após impressão
        setTimeout(() => {
          // Restaurar displays originais
          estadosOriginais.forEach(item => {
            item.elemento.style.display = item.display;
          });
          
          // Fechar FAQs que foram expandidas
          faqsExpandidas.forEach(el => {
            el.classList.remove('active');
          });
        }, 1000);
      }, 500);
    }

    // Controle do índice flutuante
    function toggleIndex() {
      const index = document.getElementById('floatingIndex');
      index.classList.toggle('collapsed');
    }

    // Demonstração interativa do modo
    function demonstrarModo(modo) {
      const statusElement = document.getElementById('demoStatus');
      const sliderContainer = document.getElementById('demoSliderContainer');
      
      if (modo === 'manual') {
        statusElement.textContent = '🔧 Sistema em Modo Manual - Controles Liberados';
        statusElement.className = 'demo-status manual';
        sliderContainer.style.display = 'block';
        toast.success('Modo Manual Ativo', 'Agora você pode ajustar o brilho manualmente');
      } else {
        statusElement.textContent = '🤖 Sistema em Modo Automático - Funcionamento Automático';
        statusElement.className = 'demo-status automatico';
        sliderContainer.style.display = 'none';
        toast.info('Modo Automático Ativo', 'Sistema funcionando conforme agendamentos');
      }
    }

    // Atualização do slider de demonstração
    function atualizarDemoSlider(valor) {
      const sliderElement = document.getElementById('demoSlider');
      const valueElement = document.getElementById('demoValue');
      
      valueElement.textContent = valor + '%';
      
      // Atualizar cor do slider
      const porcentagem = valor;
      sliderElement.style.background = `linear-gradient(to right, #8e44ad  0%, #8e44ad  ${porcentagem}%, #8e44ad  ${porcentagem}%, #e0e0e0 100%)`;
    }

    // Controle de FAQ
    function toggleFaq(button) {
      const answer = button.nextElementSibling;
      const isActive = button.classList.contains('active');
      
      // Fechar todas as FAQs abertas
      document.querySelectorAll('.faq-question.active').forEach(q => {
        q.classList.remove('active');
        q.nextElementSibling.classList.remove('active');
      });
      
      // Abrir a FAQ clicada se ela não estava ativa
      if (!isActive) {
        button.classList.add('active');
        answer.classList.add('active');
      }
    }

    // Navegação suave para âncoras
    function navegarPara(secaoId) {
      const secao = document.getElementById(secaoId);
      if (secao) {
        secao.scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
        
        // Atualizar índice ativo
        document.querySelectorAll('.index-link').forEach(link => {
          link.classList.remove('active');
        });
        document.querySelector(`[href="#${secaoId}"]`)?.classList.add('active');
        
        toast.info('Navegação', `${secao.querySelector('.section-title').textContent.replace(/^.+?\s/, '')}`);
      }
    }

    // Monitoramento de scroll para atualizar índice ativo
    function monitorarScroll() {
      // Atualizar seção ativa no índice
      const secoes = document.querySelectorAll('.manual-section[id]');
      let secaoAtiva = '';
      
      secoes.forEach(secao => {
        const rect = secao.getBoundingClientRect();
        if (rect.top <= 150 && rect.bottom >= 150) {
          secaoAtiva = secao.id;
        }
      });
      
      if (secaoAtiva) {
        document.querySelectorAll('.index-link').forEach(link => {
          link.classList.remove('active');
        });
        document.querySelector(`[href="#${secaoAtiva}"]`)?.classList.add('active');
      }
    }

    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Configurar busca
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            limparPesquisa();
          } else if (e.key === 'Enter') {
            e.preventDefault();
            realizarBusca(e.target.value);
          } else if (e.key === 'ArrowDown' && resultadosBusca.length > 0) {
            e.preventDefault();
            navegarProximoResultado();
          } else if (e.key === 'ArrowUp' && resultadosBusca.length > 0) {
            e.preventDefault();
            navegarResultadoAnterior();
          }
        });
      }
      
      // Verificar se as bibliotecas PDF foram carregadas
      setTimeout(() => {
        if (typeof window.jsPDF === 'undefined' || typeof html2canvas === 'undefined') {
          // Alterar função do botão para método simples
          document.getElementById('downloadPdfBtn').onclick = gerarPDFSimples;
        }
      }, 3000);
      
      // Notificação de boas-vindas
      setTimeout(() => {
        toast.system('Manual Carregado', 'Bem-vindo ao Manual de Operação! Digite sua busca e pressione ENTER. Use ↑↓ para navegar entre resultados.', {
          duration: 8000
        });
      }, 1000);
      
      // Configurar navegação do índice
      document.querySelectorAll('.index-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const secaoId = this.getAttribute('href').substring(1);
          navegarPara(secaoId);
        });
      });
      
      // Configurar animação de piscar para demo
      const style = document.createElement('style');
      style.textContent = `
        @keyframes piscar {
          0% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.6; transform: scale(0.98); }
          100% { opacity: 1; transform: scale(1); }
        }
      `;
      document.head.appendChild(style);
      
      // Monitorar scroll
      window.addEventListener('scroll', monitorarScroll);
      
      // Inicializar demonstrações
      atualizarDemoSlider(50);
      
      // Detectar se é mobile para ajustar índice
      if (window.innerWidth <= 1024) {
        document.getElementById('floatingIndex').classList.remove('collapsed');
      }

      // Efeitos de hover nos componentes
      document.querySelectorAll('.componente-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-3px) scale(1.01)';
        });
        
        item.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(-2px) scale(1)';
        });
      });

      // Animação de carregamento
      document.querySelectorAll('.componente-item, .sistema-card').forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          item.style.transition = 'all 0.6s ease';
          item.style.opacity = '1';
          item.style.transform = 'translateY(0)';
        }, index * 100);
      });
    });

    // Redimensionamento da janela
    window.addEventListener('resize', function() {
      if (window.innerWidth <= 1024) {
        document.getElementById('floatingIndex').classList.remove('collapsed');
      }
    });

    // Atalhos de teclado
    document.addEventListener('keydown', function(e) {
      // Ctrl + Home = Voltar ao topo
      if (e.ctrlKey && e.key === 'Home') {
        e.preventDefault();
        voltarAoTopo();
      }
      
      // F1 = Mostrar/ocultar índice
      if (e.key === 'F1') {
        e.preventDefault();
        toggleIndex();
      }
      
      // Ctrl + S = Download PDF
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        gerarPDF();
      }
      
      // Ctrl + P = Imprimir/PDF simples
      if (e.ctrlKey && e.key === 'p') {
        e.preventDefault();
        gerarPDFSimples();
      }
    });

    // Feedback de interação
    document.querySelectorAll('.demo-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // Feedback visual apenas
        this.style.transform = 'scale(0.95)';
        setTimeout(() => {
          this.style.transform = '';
        }, 150);
      });
    });

    // Auto-save da posição do scroll (para recarregamentos de página)
    window.addEventListener('beforeunload', function() {
      localStorage.setItem('manualScrollPosition', window.pageYOffset);
    });

    window.addEventListener('load', function() {
      const savedPosition = localStorage.getItem('manualScrollPosition');
      if (savedPosition) {
        setTimeout(() => {
          window.scrollTo(0, parseInt(savedPosition));
          localStorage.removeItem('manualScrollPosition');
        }, 100);
      }
    });

    // ========== VERIFICAÇÃO DE CONEXÃO ==========
    
    // Variáveis para controle de status de conexão
    let statusConexao = false;
    let toastConexaoId = null;
    let verificandoConexao = false;
    let tentativasFalhas = 0;

    // Função Para Verificar Conexão Com a Rede WiFi Específica
    async function verificarConexaoViza() {
      // Se já sabemos que não há internet, não adianta tentar
      if (!navigator.onLine) {
        return false;
      }

      try {
        // Verificar se é possível acessar o sistema Viza
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 4000); // 4 segundos

        const response = await fetch('/estado', {
          method: 'GET',
          signal: controller.signal,
          cache: 'no-cache'
        });
        clearTimeout(timeoutId);

        if (response.ok) {
          tentativasFalhas = 0; // Resetar contador em caso de sucesso
          return true;
        } else {
          tentativasFalhas++;
          return false;
        }
      } catch (error) {
        tentativasFalhas++;
        console.log(`Erro na verificação de conexão (tentativa ${tentativasFalhas}):`, error.name);
        // Só retorna 'false' de fato após 6 tentativas
        if (tentativasFalhas < 6) {
          return true; // Finge que está online para ser mais tolerante
        }
        console.log('Erro na verificação de conexão:', error.name);
        return false;
      }
    }

    // Função Para Atualizar Status da Conexão
    async function atualizarStatusConexao() {
      if (verificandoConexao) return;
      verificandoConexao = true;

      try {
        const conectadoViza = await verificarConexaoViza();
        const statusElement = document.getElementById('status-conexao');
        const statusText = document.getElementById('status-text');
        
        if (statusElement) {
          if (conectadoViza && !statusConexao) {
            // Conectou à rede Viza
            statusText.textContent = 'Conectado';
            statusElement.className = 'status-conexao status-online';
            
            // Remover toast de conexão perdida se existir
            if (toastConexaoId) {
              toast.remove(toastConexaoId);
              toastConexaoId = null;
            }
            
            toast.success('Conectado à rede Iluminação_Viza', 'Sistema de iluminação disponível');

          } else if (!conectadoViza && statusConexao) {
            // Perdeu conexão com a rede Viza
            statusText.textContent = 'Desconectado';
            statusElement.className = 'status-conexao status-offline';
            
            toastConexaoId = toast.error('Fora da rede Iluminação_Viza', 'Conecte-se à rede WiFi "Iluminação_Viza" para acessar o sistema', {
              persistent: true,
              action: {
                text: 'Tentar Novamente',
                callback: () => {
                  atualizarStatusConexao();
                  toast.info('Verificando...', 'Tentando conectar à rede Iluminação_Viza');
                }
              }
            });
          }
          
          statusConexao = conectadoViza;
        }
      } catch (error) {
        console.error('Erro ao verificar status:', error);
      } finally {
        verificandoConexao = false;
      }
    }

    // Monitoramento de rede
    function monitorarConexao() {
      // Verificar mudanças na conectividade geral
      window.addEventListener('online', () => {
        setTimeout(atualizarStatusConexao, 1000); // Aguardar 1 segundo e verificar
      });
      
      window.addEventListener('offline', () => {
        if (statusConexao) {
          const statusElement = document.getElementById('status-conexao');
          const statusText = document.getElementById('status-text');
          
          statusText.textContent = 'Desconectado';
          statusElement.className = 'status-conexao status-offline';
          
          toast.warning('Sem Conexão com Internet', 'Verifique sua conectividade', {
            persistent: true
          });
          
          statusConexao = false;
        }
      });

      // Verificar quando a página ganha foco (usuário volta ao app)
      window.addEventListener('focus', () => {
        setTimeout(atualizarStatusConexao, 500);
      });

      // Verificar quando há mudança de visibilidade da página
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) {
          setTimeout(atualizarStatusConexao, 500);
        }
      });
    }

    // Inicializar monitoramento de conexão
    monitorarConexao();
    
    // Verificar status inicial da conexão
    setTimeout(atualizarStatusConexao, 1000);
    
    // Verificação periódica a cada 10 segundos
    setInterval(atualizarStatusConexao, 10000);

  </script>
</body>
</html>